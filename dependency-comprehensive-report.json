{
  "stats": {
    "total_modules": 131,
    "total_dependencies": 172,
    "circular_dependencies": 0,
    "high_risk_modules": 60,
    "category_distribution": {
      "utility": 107,
      "service": 6,
      "config": 5,
      "monitoring": 3,
      "repository": 2,
      "model": 8
    }
  },
  "high_risk_modules": [
    {
      "module": "amas/core/online-loop",
      "category": "utility",
      "efferent": 9,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.78
    },
    {
      "module": "amas/decision/ensemble",
      "category": "utility",
      "efferent": 7,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.74
    },
    {
      "module": "repositories/cached-repository",
      "category": "utility",
      "efferent": 6,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.72
    },
    {
      "module": "services/word-selection.service",
      "category": "utility",
      "efferent": 5,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.7
    },
    {
      "module": "amas/models/actr-memory-native",
      "category": "model",
      "efferent": 5,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.7
    },
    {
      "module": "amas/learning/thompson-sampling-native",
      "category": "utility",
      "efferent": 5,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.7
    },
    {
      "module": "amas/services/llm-advisor/llm-weekly-advisor",
      "category": "service",
      "efferent": 5,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.7
    },
    {
      "module": "services/mastery-learning.service",
      "category": "utility",
      "efferent": 4,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6799999999999999
    },
    {
      "module": "services/learning-objectives.service",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "services/record.service",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "monitoring/monitoring-service",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/evaluation/causal-inference-native",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/monitoring/monitoring-service",
      "category": "monitoring",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/repositories/database-repository",
      "category": "repository",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/cold-start/new-user-initializer",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/learning/thompson-explore-hook",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/policies/usage-examples",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "amas/policies/examples",
      "category": "utility",
      "efferent": 3,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.6599999999999999
    },
    {
      "module": "services/plan-generator.service",
      "category": "utility",
      "efferent": 2,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.64
    },
    {
      "module": "services/tracking.service",
      "category": "utility",
      "efferent": 2,
      "afferent": 0,
      "instability": 1.0,
      "risk": 0.64
    }
  ],
  "circular_dependencies": [],
  "layer_coupling": {
    "cross_layer_counts": {
      "model->model": 1,
      "service->service": 4
    },
    "violations": []
  },
  "recommendations": [
    {
      "type": "依赖注入 (Dependency Injection)",
      "priority": "HIGH",
      "reason": "60 个模块存在高耦合",
      "suggestion": "引入DI容器,通过接口而非具体实现注入依赖",
      "impact": "降低耦合度20-30%,提高可测试性"
    }
  ],
  "import_patterns": {
    "prisma_imports": 39,
    "amas_imports": 42,
    "service_imports": 83,
    "external_imports": 119,
    "relative_imports": 463
  },
  "top_complex_files": [
    {
      "file": "amas/core/engine.ts",
      "category": "utility",
      "lines": 2360,
      "functions": 4,
      "classes": 13,
      "interfaces": 31,
      "imports": 27,
      "exports": 48,
      "complexity": 440.0
    },
    {
      "file": "amas/models/cognitive.ts",
      "category": "model",
      "lines": 1483,
      "functions": 4,
      "classes": 9,
      "interfaces": 11,
      "imports": 4,
      "exports": 25,
      "complexity": 266.3
    },
    {
      "file": "monitoring/amas-metrics.ts",
      "category": "utility",
      "lines": 813,
      "functions": 25,
      "classes": 5,
      "interfaces": 2,
      "imports": 0,
      "exports": 29,
      "complexity": 256.3
    },
    {
      "file": "monitoring/learning-metrics.ts",
      "category": "utility",
      "lines": 986,
      "functions": 27,
      "classes": 1,
      "interfaces": 3,
      "imports": 1,
      "exports": 21,
      "complexity": 245.60000000000002
    },
    {
      "file": "services/real-about.service.ts",
      "category": "utility",
      "lines": 1635,
      "functions": 3,
      "classes": 2,
      "interfaces": 1,
      "imports": 4,
      "exports": 3,
      "complexity": 206.5
    },
    {
      "file": "services/amas.service.ts",
      "category": "utility",
      "lines": 1608,
      "functions": 0,
      "classes": 1,
      "interfaces": 0,
      "imports": 17,
      "exports": 1,
      "complexity": 204.8
    },
    {
      "file": "amas/workers/compute.worker.ts",
      "category": "utility",
      "lines": 773,
      "functions": 24,
      "classes": 0,
      "interfaces": 0,
      "imports": 1,
      "exports": 1,
      "complexity": 199.3
    },
    {
      "file": "routes/about.routes.ts",
      "category": "utility",
      "lines": 1263,
      "functions": 5,
      "classes": 0,
      "interfaces": 2,
      "imports": 16,
      "exports": 1,
      "complexity": 183.3
    },
    {
      "file": "services/admin.service.ts",
      "category": "utility",
      "lines": 1610,
      "functions": 0,
      "classes": 1,
      "interfaces": 8,
      "imports": 5,
      "exports": 2,
      "complexity": 181.0
    },
    {
      "file": "services/about.service.ts",
      "category": "utility",
      "lines": 1448,
      "functions": 1,
      "classes": 2,
      "interfaces": 21,
      "imports": 5,
      "exports": 24,
      "complexity": 179.8
    },
    {
      "file": "services/learning-state.service.ts",
      "category": "utility",
      "lines": 1355,
      "functions": 1,
      "classes": 1,
      "interfaces": 8,
      "imports": 11,
      "exports": 10,
      "complexity": 172.5
    },
    {
      "file": "amas/algorithms/learners.ts",
      "category": "utility",
      "lines": 1157,
      "functions": 2,
      "classes": 3,
      "interfaces": 11,
      "imports": 4,
      "exports": 15,
      "complexity": 163.7
    },
    {
      "file": "services/metrics.service.ts",
      "category": "utility",
      "lines": 509,
      "functions": 20,
      "classes": 1,
      "interfaces": 7,
      "imports": 1,
      "exports": 20,
      "complexity": 162.9
    },
    {
      "file": "scripts/migrate-user-profiles.ts",
      "category": "utility",
      "lines": 929,
      "functions": 13,
      "classes": 0,
      "interfaces": 4,
      "imports": 1,
      "exports": 0,
      "complexity": 159.9
    },
    {
      "file": "services/user-profile.service.ts",
      "category": "utility",
      "lines": 1048,
      "functions": 1,
      "classes": 3,
      "interfaces": 5,
      "imports": 8,
      "exports": 12,
      "complexity": 155.8
    },
    {
      "file": "amas/perception/feature-builder.ts",
      "category": "utility",
      "lines": 885,
      "functions": 3,
      "classes": 4,
      "interfaces": 4,
      "imports": 3,
      "exports": 6,
      "complexity": 149.5
    },
    {
      "file": "scripts/verify-profile-consistency.ts",
      "category": "utility",
      "lines": 873,
      "functions": 10,
      "classes": 0,
      "interfaces": 3,
      "imports": 1,
      "exports": 0,
      "complexity": 139.3
    },
    {
      "file": "amas/evaluation/causal-inference.ts",
      "category": "utility",
      "lines": 1119,
      "functions": 2,
      "classes": 1,
      "interfaces": 6,
      "imports": 1,
      "exports": 10,
      "complexity": 133.9
    },
    {
      "file": "amas/decision/ensemble.ts",
      "category": "utility",
      "lines": 1005,
      "functions": 0,
      "classes": 1,
      "interfaces": 6,
      "imports": 9,
      "exports": 6,
      "complexity": 128.5
    },
    {
      "file": "amas/models/actr-memory-native.ts",
      "category": "model",
      "lines": 909,
      "functions": 2,
      "classes": 1,
      "interfaces": 2,
      "imports": 8,
      "exports": 6,
      "complexity": 126.9
    }
  ],
  "category_coupling_analysis": {
    "utility": {
      "internal": 0,
      "external": 555,
      "modules": [
        "app.ts",
        "index.ts",
        "workers/delayed-reward.worker.ts",
        "workers/forgetting-alert.worker.ts",
        "workers/optimization.worker.ts",
        "workers/llm-advisor.worker.ts",
        "scripts/migrate-user-learning-profile.ts",
        "scripts/verify-profile-consistency.ts",
        "scripts/migrate-user-profiles.ts",
        "services/answer-buffer.service.ts",
        "services/experiment.service.example.ts",
        "services/decision-recorder.service.ts",
        "services/plan-generator.service.ts",
        "services/learning-objectives.service.ts",
        "services/tracking.service.ts",
        "services/decision-events.service.ts",
        "services/difficulty-cache.service.ts",
        "services/redis-cache.service.ts",
        "services/explainability.service.ts",
        "services/word.service.ts",
        "services/algorithm-config.service.ts",
        "services/experiment.service.ts",
        "services/admin.service.ts",
        "services/state-history.service.ts",
        "services/word-selection.service.ts",
        "services/about.service.ts",
        "services/cache.service.ts",
        "services/study-config.service.ts",
        "services/word-context.service.ts",
        "services/auth.service.ts",
        "services/time-recommend.service.ts",
        "services/trend-analysis.service.ts",
        "services/evaluation.service.ts",
        "services/notification.service.ts",
        "services/amas-config.service.ts",
        "services/real-about.service.ts",
        "services/wordbook.service.ts",
        "services/metrics.service.ts",
        "services/learning-state.service.ts",
        "services/log-storage.service.ts",
        "services/realtime.service.ts",
        "services/amas.service.ts",
        "services/record.service.ts",
        "services/user-profile.service.ts",
        "services/llm-provider.service.ts",
        "services/badge.service.ts",
        "services/mastery-learning.service.ts",
        "services/preference.service.ts",
        "services/delayed-reward.service.ts",
        "services/index.ts",
        "services/optimization.service.ts",
        "services/learning-session.service.ts",
        "validators/word-state.validator.ts",
        "validators/record.validator.ts",
        "validators/auth.validator.ts",
        "validators/common.validator.ts",
        "validators/admin.validator.ts",
        "validators/word.validator.ts",
        "validators/word-score.validator.ts",
        "validators/amas.validator.ts",
        "core/event-bus.example.ts",
        "core/event-bus.ts",
        "core/index.ts",
        "config/llm.config.ts",
        "config/amas-feature-flags.ts",
        "config/database.ts",
        "config/env.ts",
        "config/redis.ts",
        "config/sentry.ts",
        "routes/word-score.routes.ts",
        "routes/time-recommend.routes.ts",
        "routes/optimization.routes.ts",
        "routes/alerts.routes.ts",
        "routes/logs.routes.ts",
        "routes/learning.routes.ts",
        "routes/trend-analysis.routes.ts",
        "routes/learning-objectives.routes.ts",
        "routes/state-history.routes.ts",
        "routes/learning-session.routes.ts",
        "routes/plan.routes.ts",
        "routes/experiment.routes.ts",
        "routes/auth.routes.ts",
        "routes/profile.routes.ts",
        "routes/habit-profile.routes.ts",
        "routes/notification.routes.ts",
        "routes/about.routes.ts",
        "routes/study-config.routes.ts",
        "routes/amas.routes.ts",
        "routes/algorithm-config.routes.ts",
        "routes/evaluation.routes.ts",
        "routes/preference.routes.ts",
        "routes/word-mastery.routes.ts",
        "routes/health.routes.ts",
        "routes/badge.routes.ts",
        "routes/user.routes.ts",
        "routes/word-state.routes.ts",
        "routes/word-context.routes.ts",
        "routes/log-viewer.routes.ts",
        "routes/tracking.routes.ts",
        "routes/word.routes.ts",
        "routes/wordbook.routes.ts",
        "routes/amas-explain.routes.ts",
        "routes/llm-advisor.routes.ts",
        "routes/record.routes.ts",
        "routes/admin.routes.ts",
        "monitoring/monitoring-service.ts",
        "monitoring/alert-config.ts",
        "monitoring/alert-rules.ts",
        "monitoring/learning-metrics.ts",
        "monitoring/alert-engine.ts",
        "monitoring/amas-metrics.ts",
        "repositories/cached-repository.ts",
        "repositories/database-repository.ts",
        "repositories/index.ts",
        "schedulers/learning-metrics-scheduler.ts",
        "middleware/admin.middleware.ts",
        "middleware/auth.middleware.ts",
        "middleware/deprecation.middleware.example.ts",
        "middleware/validate.middleware.ts",
        "middleware/metrics.middleware.ts",
        "middleware/error.middleware.ts",
        "middleware/deprecation.middleware.ts",
        "types/index.ts",
        "logger/http.ts",
        "logger/pg-transport.ts",
        "logger/index.ts",
        "amas/engine.ts",
        "amas/types.ts",
        "amas/index.ts",
        "routes/v1/words.routes.ts",
        "routes/v1/sessions.routes.ts",
        "routes/v1/learning.routes.ts",
        "routes/v1/realtime.routes.ts",
        "routes/v1/auth.routes.ts",
        "routes/v1/users.routes.ts",
        "routes/v1/index.ts",
        "amas/workers/pool.ts",
        "amas/workers/compute.worker.ts",
        "amas/workers/index.ts",
        "amas/evaluation/word-mastery-evaluator.ts",
        "amas/evaluation/causal-inference.ts",
        "amas/evaluation/causal-inference-native.ts",
        "amas/evaluation/index.ts",
        "amas/modeling/forgetting-curve.ts",
        "amas/modeling/trend-analyzer.ts",
        "amas/modeling/actr-memory.ts",
        "amas/modeling/motivation-tracker.ts",
        "amas/modeling/cognitive-profiler.ts",
        "amas/modeling/fatigue-estimator.ts",
        "amas/modeling/attention-monitor.ts",
        "amas/versioning/model-registry.ts",
        "amas/versioning/types.ts",
        "amas/versioning/version-manager.ts",
        "amas/versioning/index.ts",
        "amas/tracking/word-memory-tracker.ts",
        "amas/interfaces/index.ts",
        "amas/core/engine.ts",
        "amas/core/online-loop.example.ts",
        "amas/core/multi-objective-optimizer.ts",
        "amas/core/offline-loop.ts",
        "amas/core/online-loop.ts",
        "amas/core/offline-loop.example.ts",
        "amas/core/optimizer.ts",
        "amas/core/index.ts",
        "amas/perception/feature-builder.ts",
        "amas/common/smart-wrapper-base.ts",
        "amas/common/smart-router.ts",
        "amas/common/telemetry.ts",
        "amas/common/type-validators.ts",
        "amas/common/circuit-breaker.ts",
        "amas/common/matrix-utils.ts",
        "amas/common/index.ts",
        "amas/optimization/bayesian-optimizer.ts",
        "amas/optimization/multi-objective-optimizer.ts",
        "amas/config/reward-profiles.ts",
        "amas/config/feature-flags.ts",
        "amas/config/user-params.ts",
        "amas/config/index.ts",
        "amas/config/action-space.ts",
        "amas/adapters/examples.ts",
        "amas/adapters/ensemble-adapter.ts",
        "amas/adapters/linucb-adapter.ts",
        "amas/adapters/thompson-adapter.ts",
        "amas/adapters/index.ts",
        "amas/monitoring/monitoring-service.ts",
        "amas/monitoring/alert-config.ts",
        "amas/monitoring/metrics-collector.ts",
        "amas/monitoring/alert-engine.ts",
        "amas/algorithms/learners.ts",
        "amas/algorithms/index.ts",
        "amas/decision/guardrails.ts",
        "amas/decision/ensemble.ts",
        "amas/decision/mapper.ts",
        "amas/decision/fallback.ts",
        "amas/decision/explain.ts",
        "amas/decision/multi-objective-decision.ts",
        "amas/cold-start/global-stats.ts",
        "amas/cold-start/new-user-initializer.ts",
        "amas/learning/linucb-async.ts",
        "amas/learning/linucb-native-wrapper.ts",
        "amas/learning/native-wrapper.ts",
        "amas/learning/linucb.ts",
        "amas/learning/thompson-explore-hook.ts",
        "amas/learning/math-utils.ts",
        "amas/learning/coldstart.ts",
        "amas/learning/heuristic.ts",
        "amas/learning/thompson-sampling-native.ts",
        "amas/learning/thompson-sampling.ts",
        "amas/learning/index.ts",
        "amas/utils/state-converter.ts",
        "amas/rewards/evaluators.ts",
        "amas/rewards/delayed-reward-aggregator.ts",
        "amas/rewards/immediate-reward.ts",
        "amas/rewards/index.ts",
        "amas/policies/usage-examples.ts",
        "amas/policies/examples.ts",
        "amas/policies/fatigue-based.ts",
        "amas/policies/micro-session-policy.ts",
        "amas/policies/policy-registry.ts",
        "amas/policies/word-selector.interface.ts",
        "amas/policies/index.ts"
      ]
    },
    "service": {
      "internal": 3,
      "external": 11,
      "modules": [
        "amas/services/decision-recorder.service.ts",
        "amas/services/llm-advisor/stats-collector.ts",
        "amas/services/llm-advisor/prompts.ts",
        "amas/services/llm-advisor/suggestion-parser.ts",
        "amas/services/llm-advisor/llm-weekly-advisor.ts",
        "amas/services/llm-advisor/index.ts"
      ]
    },
    "repository": {
      "internal": 0,
      "external": 6,
      "modules": [
        "amas/repositories/cached-repository.ts",
        "amas/repositories/database-repository.ts"
      ]
    },
    "model": {
      "internal": 0,
      "external": 13,
      "modules": [
        "amas/models/forgetting-curve.ts",
        "amas/models/emotion-detector.example.ts",
        "amas/models/actr-memory.ts",
        "amas/models/actr-memory-native.ts",
        "amas/models/flow-detector.ts",
        "amas/models/fatigue-estimator.ts",
        "amas/models/emotion-detector.ts",
        "amas/models/cognitive.ts",
        "amas/models/index.ts"
      ]
    }
  },
  "god_objects": [
    {
      "file": "amas/core/engine.ts",
      "lines": 2360,
      "functions_methods": 92,
      "imports": 27,
      "god_score": 121.0
    },
    {
      "file": "scripts/verify-profile-consistency.ts",
      "lines": 873,
      "functions_methods": 83,
      "imports": 1,
      "god_score": 91.93
    },
    {
      "file": "scripts/migrate-user-profiles.ts",
      "lines": 929,
      "functions_methods": 81,
      "imports": 1,
      "god_score": 90.49
    },
    {
      "file": "amas/workers/compute.worker.ts",
      "lines": 773,
      "functions_methods": 80,
      "imports": 1,
      "god_score": 87.93
    },
    {
      "file": "services/admin.service.ts",
      "lines": 1610,
      "functions_methods": 69,
      "imports": 5,
      "god_score": 86.1
    },
    {
      "file": "services/real-about.service.ts",
      "lines": 1635,
      "functions_methods": 63,
      "imports": 4,
      "god_score": 80.14999999999999
    },
    {
      "file": "services/learning-state.service.ts",
      "lines": 1355,
      "functions_methods": 61,
      "imports": 11,
      "god_score": 76.75
    },
    {
      "file": "services/amas.service.ts",
      "lines": 1608,
      "functions_methods": 55,
      "imports": 17,
      "god_score": 74.48
    },
    {
      "file": "monitoring/learning-metrics.ts",
      "lines": 986,
      "functions_methods": 64,
      "imports": 1,
      "god_score": 74.06
    },
    {
      "file": "amas/evaluation/causal-inference.ts",
      "lines": 1119,
      "functions_methods": 60,
      "imports": 1,
      "god_score": 71.39
    }
  ],
  "deep_dependencies": {
    "amas/services/llm-advisor/stats-collector.ts": {
      "max_depth": 3,
      "import_count": 4
    },
    "amas/services/llm-advisor/suggestion-parser.ts": {
      "max_depth": 3,
      "import_count": 1
    },
    "amas/services/llm-advisor/llm-weekly-advisor.ts": {
      "max_depth": 3,
      "import_count": 8
    },
    "routes/v1/words.routes.ts": {
      "max_depth": 2,
      "import_count": 7
    },
    "routes/v1/sessions.routes.ts": {
      "max_depth": 2,
      "import_count": 5
    },
    "routes/v1/learning.routes.ts": {
      "max_depth": 2,
      "import_count": 6
    },
    "routes/v1/realtime.routes.ts": {
      "max_depth": 2,
      "import_count": 3
    },
    "routes/v1/auth.routes.ts": {
      "max_depth": 2,
      "import_count": 6
    },
    "routes/v1/users.routes.ts": {
      "max_depth": 2,
      "import_count": 6
    },
    "amas/workers/pool.ts": {
      "max_depth": 2,
      "import_count": 1
    },
    "amas/evaluation/word-mastery-evaluator.ts": {
      "max_depth": 2,
      "import_count": 3
    },
    "amas/evaluation/causal-inference.ts": {
      "max_depth": 2,
      "import_count": 1
    },
    "amas/evaluation/causal-inference-native.ts": {
      "max_depth": 2,
      "import_count": 3
    },
    "amas/versioning/version-manager.ts": {
      "max_depth": 2,
      "import_count": 2
    },
    "amas/tracking/word-memory-tracker.ts": {
      "max_depth": 2,
      "import_count": 2
    },
    "amas/core/engine.ts": {
      "max_depth": 2,
      "import_count": 20
    },
    "amas/core/offline-loop.ts": {
      "max_depth": 2,
      "import_count": 3
    },
    "amas/core/online-loop.ts": {
      "max_depth": 2,
      "import_count": 9
    },
    "amas/core/offline-loop.example.ts": {
      "max_depth": 2,
      "import_count": 3
    },
    "amas/core/optimizer.ts": {
      "max_depth": 2,
      "import_count": 1
    }
  },
  "advanced_stats": {
    "total_code_lines": 83657,
    "average_file_complexity": 59.21,
    "god_objects_count": 74,
    "files_with_deep_deps": 3,
    "average_imports_per_file": 3.51
  }
}
