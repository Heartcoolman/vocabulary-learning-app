# 测试快速开始指南

## 前置条件

只需要安装 **Docker Desktop**（Windows/Mac）或 **Docker**（Linux）

## 一键启动测试

### 1. 启动测试数据库并运行迁移

```bash
npm run test:setup
```

这个命令会：
- 启动Docker容器中的PostgreSQL测试数据库（端口5433）
- 自动运行数据库迁移

### 2. 运行测试

```bash
# 只运行单元测试（不需要数据库）
npm run test:unit

# 运行集成测试（需要数据库）
npm run test:integration

# 运行所有测试
npm test
```

### 3. 停止测试数据库

```bash
npm run test:db:down
```

## 详细命令说明

| 命令 | 说明 |
|------|------|
| `npm run test:db:up` | 启动测试数据库容器 |
| `npm run test:db:down` | 停止并删除测试数据库容器 |
| `npm run test:db:migrate` | 运行数据库迁移 |
| `npm run test:setup` | 一键启动数据库+迁移 |
| `npm run test:unit` | 运行单元测试 |
| `npm run test:integration` | 运行集成测试 |
| `npm test` | 运行所有测试 |

## 常见问题

### Q: 端口5433被占用怎么办？

修改 `docker-compose.test.yml` 中的端口映射：
```yaml
ports:
  - "5434:5432"  # 改为其他端口
```

同时修改 `.env.test` 中的连接字符串：
```
DATABASE_URL="postgresql://postgres:postgres@localhost:5434/vocabulary_db_test"
```

### Q: Docker容器启动失败？

检查Docker是否正在运行：
```bash
docker ps
```

### Q: 测试数据库连接失败？

等待几秒让数据库完全启动，然后重试：
```bash
npm run test:db:migrate
```

## 无Docker方案

如果无法使用Docker，可以：

1. **使用远程测试数据库**（不推荐）
   - 修改 `.env.test` 指向远程数据库
   - 注意：不要使用生产数据库！

2. **只运行单元测试**
   ```bash
   npm run test:unit
   ```
   单元测试使用mock，不需要真实数据库
