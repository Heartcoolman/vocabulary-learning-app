apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: Danci - æ™ºèƒ½å•è¯å­¦ä¹ åº”ç”¨
spec:
  description: åŸºäº AMAS è‡ªé€‚åº”å­¦ä¹ å¼•æ“çš„æ™ºèƒ½å•è¯å­¦ä¹ åº”ç”¨ï¼Œæ”¯æŒè§†è§‰ç–²åŠ³æ£€æµ‹
  icon: https://raw.githubusercontent.com/Heartcoolman/vocabulary-learning-app/main/packages/frontend/public/favicon.svg
  tags:
    - Education
    - Learning
    - Vocabulary
  readme: |
    # Danci - æ™ºèƒ½å•è¯å­¦ä¹ åº”ç”¨

    åŸºäº AMAS (Adaptive Memory Acquisition System) è‡ªé€‚åº”å­¦ä¹ å¼•æ“çš„æ™ºèƒ½å•è¯å­¦ä¹ åº”ç”¨ã€‚

    ## åŠŸèƒ½ç‰¹ç‚¹
    - ğŸ§  AMAS è‡ªé€‚åº”å­¦ä¹ å¼•æ“ (LinUCB/Thompson/ACT-R)
    - ğŸ‘ï¸ è§†è§‰ç–²åŠ³æ£€æµ‹
    - ğŸ“Š å­¦ä¹ æ•°æ®ç»Ÿè®¡åˆ†æ
    - ğŸ“š è¯åº“ç®¡ç†

    ## éƒ¨ç½²åè®¿é—®
    - å‰ç«¯åº”ç”¨é€šè¿‡ç»‘å®šçš„åŸŸåè®¿é—®
    - é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·è¯·æŸ¥çœ‹åç«¯æ—¥å¿—

  variables:
    - key: PUBLIC_DOMAIN
      type: DOMAIN
      name: åº”ç”¨åŸŸå
      description: å‰ç«¯åº”ç”¨è®¿é—®åŸŸå
    - key: JWT_SECRET
      type: STRING
      name: JWT å¯†é’¥
      description: JWT ç­¾åå¯†é’¥ï¼ˆè‡³å°‘ 64 å­—ç¬¦ï¼‰

  services:
    # PostgreSQL æ•°æ®åº“
    - name: postgres
      template: PREBUILT
      spec:
        source:
          image: timescale/timescaledb:latest-pg15
        ports:
          - id: database
            port: 5432
            type: TCP
        volumes:
          - id: data
            dir: /var/lib/postgresql/data
        env:
          POSTGRES_DB:
            default: vocabulary_db
          POSTGRES_USER:
            default: danci
          POSTGRES_PASSWORD:
            default: ${PASSWORD}
            expose: true
          DATABASE_URL:
            default: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${CONTAINER_HOSTNAME}:5432/${POSTGRES_DB}
            expose: true
            readonly: true

    # Redis ç¼“å­˜
    - name: redis
      template: PREBUILT
      spec:
        source:
          image: redis:7-alpine
        ports:
          - id: cache
            port: 6379
            type: TCP
        volumes:
          - id: data
            dir: /data
        env:
          REDIS_URL:
            default: redis://${CONTAINER_HOSTNAME}:6379
            expose: true
            readonly: true

    # Rust åç«¯
    - name: backend
      template: GIT
      icon: https://www.rust-lang.org/logos/rust-logo-512x512.png
      spec:
        source:
          type: GITHUB
          repoURL: https://github.com/Heartcoolman/vocabulary-learning-app
          branch: main
          subPath: packages/backend-rust
        ports:
          - id: api
            port: 3000
            type: HTTP
        volumes:
          - id: data
            dir: /app/data
        env:
          HOST:
            default: '0.0.0.0'
          PORT:
            default: '3000'
          RUST_LOG:
            default: info
          DATABASE_URL:
            default: ${postgres.DATABASE_URL}
          REDIS_URL:
            default: ${redis.REDIS_URL}
          JWT_SECRET:
            default: ${JWT_SECRET}
          CORS_ORIGIN:
            default: https://${PUBLIC_DOMAIN}
          SQLITE_FALLBACK_ENABLED:
            default: 'true'
          SQLITE_FALLBACK_PATH:
            default: /app/data/fallback.db
      dependencies:
        - postgres
        - redis

    # å‰ç«¯åº”ç”¨
    - name: frontend
      template: GIT
      icon: https://vitejs.dev/logo.svg
      domainKey: PUBLIC_DOMAIN
      spec:
        source:
          type: GITHUB
          repoURL: https://github.com/Heartcoolman/vocabulary-learning-app
          branch: main
          subPath: packages/frontend
        ports:
          - id: web
            port: 80
            type: HTTP
        env:
          VITE_API_URL:
            default: https://${ZEABUR_WEB_DOMAIN}/api
      dependencies:
        - backend
