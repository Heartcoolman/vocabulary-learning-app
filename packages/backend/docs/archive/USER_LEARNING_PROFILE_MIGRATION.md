# UserLearningProfile æ•°æ®è¿ç§»å¿«é€Ÿå¼€å§‹

## ç®€ä»‹

æœ¬è„šæœ¬ç”¨äºå°† `AmasUserState` è¡¨çš„æ•°æ®è¿ç§»åˆ° `UserLearningProfile` è¡¨ã€‚

## å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šé¢„è§ˆè¿ç§»

åœ¨å®é™…è¿ç§»å‰ï¼Œå…ˆè¿è¡Œé¢„è§ˆæ¨¡å¼æŸ¥çœ‹å°†è¦è¿ç§»çš„æ•°æ®ï¼š

```bash
npm run migrate:user-learning-profile
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
ğŸš€ å¼€å§‹è¿ç§» AmasUserState -> UserLearningProfile

ğŸ“‹ æ¨¡å¼: é¢„è§ˆæ¨¡å¼ï¼ˆä¸ä¿®æ”¹æ•°æ®ï¼‰

ğŸ“Š æŸ¥è¯¢ AmasUserState æ•°æ®...
   æ‰¾åˆ° 100 æ¡è®°å½•

ğŸ” éªŒè¯ç”¨æˆ·æ•°æ®...
   âœ… æœ‰æ•ˆè®°å½•: 100

ğŸ”§ æ•°æ®éªŒè¯ä¸è½¬æ¢...
âœ… å·²è½¬æ¢ 100 æ¡è®°å½•

ğŸ“‹ è½¬æ¢åçš„æ•°æ®ç¤ºä¾‹ï¼ˆå‰10æ¡ï¼‰:
----------------------------------------------------------------------------------------------------
1. userId: xxx-xxx-xxx
   theta: 0.651, thetaVariance: 0.100
   attention: 0.432, fatigue: 0.915, motivation: 0.488
   emotionBaseline: neutral, flowScore: 0.363
...

âš ï¸  é¢„è§ˆæ¨¡å¼ï¼šæœªä¿®æ”¹ä»»ä½•æ•°æ®
ğŸ’¡ å¦‚éœ€æ‰§è¡Œè¿ç§»ï¼Œè¯·ä½¿ç”¨: npm run migrate:user-learning-profile -- --execute
```

### ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œè¿ç§»

ç¡®è®¤é¢„è§ˆç»“æœæ— è¯¯åï¼Œæ‰§è¡Œå®é™…è¿ç§»ï¼š

```bash
npm run migrate:user-learning-profile:execute
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
ğŸš€ å¼€å§‹è¿ç§» AmasUserState -> UserLearningProfile

ğŸ“‹ æ¨¡å¼: æ‰§è¡Œæ¨¡å¼

ğŸ“Š æŸ¥è¯¢ AmasUserState æ•°æ®...
   æ‰¾åˆ° 100 æ¡è®°å½•

ğŸ” éªŒè¯ç”¨æˆ·æ•°æ®...
   âœ… æœ‰æ•ˆè®°å½•: 100

ğŸ“¦ å¤‡ä»½ç°æœ‰çš„ UserLearningProfile æ•°æ®...
âœ… å·²å¤‡ä»½ 0 æ¡è®°å½•

ğŸ”§ æ•°æ®éªŒè¯ä¸è½¬æ¢...
âœ… å·²è½¬æ¢ 100 æ¡è®°å½•

ğŸ”§ å¼€å§‹æ‰§è¡Œè¿ç§»...
   å¤„ç†æ‰¹æ¬¡ 1/2...
   å¤„ç†æ‰¹æ¬¡ 2/2...

================================================================================
ğŸ“Š è¿ç§»ç»Ÿè®¡:
   - æ€»è®°å½•æ•°: 100
   - æˆåŠŸ: 100
   - å¤±è´¥: 0
   - è·³è¿‡: 0

ğŸ” éªŒè¯è¿ç§»ç»“æœ...

ğŸ“Š æ•°æ®ç»Ÿè®¡:
   - AmasUserState è®°å½•æ•°: 100
   - UserLearningProfile è®°å½•æ•°: 100
   - User æ€»æ•°: 150

ğŸ“ˆ è¦†ç›–ç‡åˆ†æ:
   - æœ‰ AmasUserState çš„ç”¨æˆ·: 100
   - æœ‰ UserLearningProfile çš„ç”¨æˆ·: 100
   - ç¼ºå°‘ UserLearningProfile çš„ç”¨æˆ·: 0
   - å¤šä½™çš„ UserLearningProfile: 0

ğŸ”¬ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæŠ½æ ·10æ¡ï¼‰...
   âœ… ç”¨æˆ· xxx æ•°æ®ä¸€è‡´
   âœ… ç”¨æˆ· xxx æ•°æ®ä¸€è‡´
   ...

ğŸ“‹ éªŒè¯æ€»ç»“:
   - è¿ç§»è¦†ç›–ç‡: 100.0%
   ğŸ‰ è¿ç§»å®Œæˆåº¦: ä¼˜ç§€

================================================================================
âœ… å®Œæˆï¼
================================================================================
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ç»“æœ

è¿ç§»å®Œæˆåï¼Œå¯ä»¥å•ç‹¬è¿è¡ŒéªŒè¯å‘½ä»¤ï¼š

```bash
npm run migrate:user-learning-profile:verify
```

## å¸¸è§åœºæ™¯

### åœºæ™¯ 1ï¼šè¡¨ä¸å­˜åœ¨

å¦‚æœç›®æ ‡è¡¨è¿˜æœªåˆ›å»ºï¼Œè„šæœ¬ä¼šæç¤ºï¼š

```
âŒ UserLearningProfile è¡¨ä¸å­˜åœ¨

ğŸ’¡ è¯·å…ˆè¿è¡Œ Prisma è¿ç§»åˆ›å»ºè¡¨ï¼š
   npm run prisma:migrate

æˆ–è€…å¦‚æœå·²ç»æœ‰è¿ç§»æ–‡ä»¶ï¼Œè¯·è¿è¡Œï¼š
   npx prisma migrate deploy
```

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
npm run prisma:migrate
```

### åœºæ™¯ 2ï¼šå¢é‡è¿ç§»

å¦‚æœä¹‹åæœ‰æ–°çš„ `AmasUserState` æ•°æ®éœ€è¦è¿ç§»ï¼Œç›´æ¥é‡æ–°è¿è¡Œå³å¯ï¼š

```bash
npm run migrate:user-learning-profile:execute
```

è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†å¢é‡è¿ç§»ï¼ˆä½¿ç”¨ `upsert` æ“ä½œï¼‰ã€‚

### åœºæ™¯ 3ï¼šæ•°æ®éªŒè¯å¤±è´¥

å¦‚æœæœ‰æ•°æ®éªŒè¯å¤±è´¥ï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºé”™è¯¯è¯¦æƒ…ï¼š

```
âŒ é”™è¯¯è¯¦æƒ…ï¼ˆå‰10æ¡ï¼‰:
   1. userId: xxx-xxx-xxx
      é”™è¯¯: Validation failed: attention out of range: 1.5
   2. userId: yyy-yyy-yyy
      é”™è¯¯: Transformation failed: Invalid cognitiveProfile JSON
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. ä¿®å¤æºæ•°æ®ï¼ˆ`AmasUserState` è¡¨ï¼‰
2. é‡æ–°è¿è¡Œè¿ç§»è„šæœ¬

### åœºæ™¯ 4ï¼šå›æ»šè¿ç§»

å¦‚æœéœ€è¦å›æ»šåˆ°è¿ç§»å‰çš„çŠ¶æ€ï¼ˆä»…åœ¨åŒä¸€ä¼šè¯å†…æœ‰æ•ˆï¼‰ï¼š

```bash
npm run migrate:user-learning-profile:rollback
```

**æ³¨æ„ï¼š** å›æ»šä»…èƒ½æ¢å¤æœ¬æ¬¡ä¼šè¯ä¸­å¤‡ä»½çš„æ•°æ®ã€‚

## æ•°æ®æ˜ å°„è¯´æ˜

| æºå­—æ®µ (AmasUserState) | ç›®æ ‡å­—æ®µ (UserLearningProfile) | è½¬æ¢è¯´æ˜                                      |
| ---------------------- | ------------------------------ | --------------------------------------------- |
| `userId`               | `userId`                       | ç›´æ¥æ˜ å°„                                      |
| `attention`            | `attention`                    | ç›´æ¥æ˜ å°„ (0-1)                                |
| `fatigue`              | `fatigue`                      | ç›´æ¥æ˜ å°„ (0-1)                                |
| `motivation`           | `motivation`                   | ç›´æ¥æ˜ å°„ (-1 åˆ° 1)                            |
| `cognitiveProfile`     | `theta`                        | è®¡ç®—ï¼š(mem + speed + stability) / 3           |
| `confidence`           | `thetaVariance`                | è®¡ç®—ï¼š1 - confidence                          |
| `trendState`           | `emotionBaseline`              | ä» JSON æå–æƒ…ç»ªæ ‡ç­¾                          |
| -                      | `flowScore`                    | è®¡ç®—ï¼šattention _ 0.6 + abs(motivation) _ 0.4 |
| -                      | `flowBaseline`                 | é»˜è®¤ï¼š0.5                                     |
| -                      | `activePolicyVersion`          | é»˜è®¤ï¼š'v1'                                    |
| `cognitiveProfile`     | `forgettingParams`             | JSON å­—ç¬¦ä¸²åŒ–                                 |

## æ€§èƒ½æŒ‡æ ‡

- **å¤„ç†é€Ÿåº¦**ï¼šçº¦ 50-100 æ¡/ç§’
- **æ‰¹å¤„ç†å¤§å°**ï¼š50 æ¡/æ‰¹æ¬¡
- **å†…å­˜å ç”¨**ï¼šä½ï¼ˆæ‰¹é‡å¤„ç†ï¼‰
- **äº‹åŠ¡ä¿æŠ¤**ï¼šæ¯æ‰¹ç‹¬ç«‹äº‹åŠ¡

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š[src/scripts/README.md](/packages/backend/src/scripts/README.md)

æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
