# 用户详情页面 (UserDetailPage)

## 功能概述

用户详情页面是管理员后台的核心功能之一，用于查看和分析单个用户的详细学习数据。该页面提供了全面的用户学习统计信息和单词掌握情况。

## 主要功能

### 1. 用户基本信息

- 显示用户头像、用户名和邮箱
- 提供返回用户列表的导航按钮

### 2. 学习统计卡片

显示 6 个关键统计指标：

- **总学习单词数**: 用户学习过的不同单词总数
- **平均单词得分**: 所有单词的平均得分（0-100分）
- **整体正确率**: 所有答题记录的正确率百分比
- **学习天数**: 从第一次学习到现在的总天数
- **连续学习天数**: 当前连续学习的天数（用火焰图标表示）
- **总学习时长**: 累计学习时间（分钟）

### 3. 掌握程度分布

以网格形式展示用户在各个掌握程度级别的单词数量：

- Level 0: 新单词（灰色）
- Level 1: 初识（蓝色）
- Level 2: 熟悉（绿色）
- Level 3: 掌握（黄色）
- Level 4: 熟练（橙色）
- Level 5: 精通（紫色）

### 4. 单词列表

显示用户学习的所有单词，包含以下信息：

- 单词拼写和音标
- 单词得分（0-100分，颜色编码）
- 掌握程度（0-5级）
- 正确率（百分比，颜色编码）
- 学习次数
- 最近学习时间
- 下次复习时间
- 学习状态（新单词/学习中/复习中/已掌握）

### 5. 筛选和排序功能

#### 筛选选项

- **得分范围**: 低分(0-40) / 中等(40-80) / 高分(80-100)
- **掌握程度**: 0-5级
- **学习状态**: 新单词 / 学习中 / 复习中 / 已掌握
- **最低正确率**: 可设置最低正确率阈值

#### 排序选项

- **单词得分**: 按得分升序/降序
- **正确率**: 按正确率升序/降序
- **学习次数**: 按复习次数升序/降序
- **最近学习时间**: 按最后学习时间升序/降序

### 6. 分页功能

- 支持分页浏览单词列表
- 每页显示 20 个单词
- 显示当前页码和总页数
- 提供上一页/下一页按钮
- 智能显示页码（当前页前后2页）

## 技术实现

### 前端组件

- **路由**: `/admin/users/:userId`
- **组件**: `src/pages/admin/UserDetailPage.tsx`
- **状态管理**: React Hooks (useState, useEffect)
- **导航**: React Router (useParams, useNavigate)

### API 接口

1. **获取用户详细统计**: `GET /api/admin/users/:id/statistics`
   - 返回用户的学习统计数据和掌握程度分布

2. **获取用户单词列表**: `GET /api/admin/users/:id/words`
   - 支持分页、筛选和排序参数
   - 返回单词详情和分页信息

### 后端服务

- **服务**: `backend/src/services/admin.service.ts`
  - `getUserDetailedStatistics()`: 计算用户详细统计数据
  - `getUserWords()`: 获取用户单词列表（支持筛选和排序）

- **路由**: `backend/src/routes/admin.routes.ts`
  - 添加了两个新的管理员路由

## 数据流

```
用户访问页面
    ↓
加载用户统计数据 (adminGetUserStatistics)
    ↓
显示统计卡片和掌握程度分布
    ↓
加载单词列表 (adminGetUserWords)
    ↓
显示单词表格
    ↓
用户应用筛选/排序
    ↓
重新加载单词列表
```

## UI/UX 特性

### 视觉设计

- 使用毛玻璃效果卡片（backdrop-blur）
- 统计卡片使用不同颜色的图标（Phosphor Icons）
- 得分和正确率使用颜色编码（绿色=好，黄色=中等，红色=差）
- 掌握程度使用不同颜色标识

### 交互设计

- 点击"筛选和排序"按钮展开/收起筛选器
- 排序方向切换按钮（升序/降序图标）
- 表格行悬停效果
- 分页按钮禁用状态
- 加载状态显示

### 响应式设计

- 统计卡片：移动端1列，平板2列，桌面4列
- 掌握程度分布：移动端2列，平板3列，桌面6列
- 筛选器：移动端1列，平板2列，桌面4列
- 表格支持横向滚动

## 性能优化

1. **分页加载**: 每次只加载 20 个单词，避免一次性加载大量数据
2. **条件查询**: 在数据库层面进行筛选和排序，减少数据传输
3. **批量查询**: 使用 Map 缓存单词信息，减少数据库查询次数
4. **懒加载**: 统计数据和单词列表分别加载，提升首屏速度

## 错误处理

- 用户不存在时显示错误提示
- 加载失败时显示错误信息和返回按钮
- 网络错误时显示友好的错误提示

## 可访问性

- 使用语义化 HTML 标签
- 按钮有明确的 title 属性
- 加载状态有文字说明
- 颜色编码同时使用文字标识

## 未来改进

1. **导出功能**: 支持导出用户单词数据为 CSV/Excel
2. **图表可视化**: 添加学习趋势图表
3. **单词详情弹窗**: 点击单词查看完整学习历史
4. **批量操作**: 支持批量标记单词状态
5. **实时更新**: 使用 WebSocket 实时更新学习数据

## 相关文件

- 前端组件: `src/pages/admin/UserDetailPage.tsx`
- API 客户端: `src/services/ApiClient.ts`
- 后端服务: `backend/src/services/admin.service.ts`
- 后端路由: `backend/src/routes/admin.routes.ts`
- 路由配置: `src/App.tsx`
- 图标组件: `src/components/Icon.tsx`

## 需求验证

该页面实现了以下需求：

✅ **Requirement 11.2**: 显示用户的详细学习统计（各掌握程度的单词分布、学习天数、连续学习天数、总学习时长）

✅ **Requirement 11.3**: 显示用户的单词列表（单词拼写、当前得分、掌握程度、正确率、最近学习时间、下次复习时间）

✅ **Requirement 11.4**: 支持按得分范围、掌握程度、正确率、学习状态筛选

✅ **Requirement 11.5**: 支持按单词得分、正确率、学习次数、最近学习时间排序（升序/降序）
