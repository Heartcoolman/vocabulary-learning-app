# 用户管理页面

## 功能概述

用户管理页面（UserManagementPage）是管理员后台的核心功能之一，用于查看和管理所有用户的学习数据。

## 主要功能

### 1. 用户列表展示

显示所有用户的学习概览，包括：

- **用户信息**
  - 用户名
  - 邮箱
  - 用户头像（图标）
  
- **角色标识**
  - 管理员（紫色徽章）
  - 普通用户（蓝色徽章）

- **学习统计**
  - 总学习单词数：用户已学习的不同单词总数
  - 平均单词得分：所有单词得分的平均值（0-100分）
  - 整体正确率：答题正确率百分比
  - 最后学习时间：最近一次学习的时间（相对时间显示）

### 2. 搜索功能

- 支持按用户名或邮箱搜索
- 实时搜索，按 Enter 键或点击搜索按钮触发
- 搜索后自动重置到第一页

### 3. 分页功能

- 每页显示 20 个用户
- 智能分页导航：
  - 显示当前页前后 2 页
  - 首页和末页始终显示
  - 页码间隔用省略号表示
- 上一页/下一页按钮
- 显示当前页范围和总数

### 4. 用户详情跳转

- 点击任意用户行可跳转到用户详情页面
- 悬停时行背景变色，提供视觉反馈

## 数据来源

### 后端 API

- **端点**: `GET /api/admin/users`
- **参数**:
  - `page`: 页码（默认 1）
  - `pageSize`: 每页数量（默认 20）
  - `search`: 搜索关键词（可选）

### 数据计算

后端服务（`admin.service.ts`）为每个用户计算以下统计数据：

1. **总学习单词数**: 通过 `answerRecord` 表的 `wordId` 去重统计
2. **平均单词得分**: 从 `wordScore` 表获取所有单词得分的平均值
3. **整体正确率**: 正确答题数 / 总答题数 × 100%
4. **最后学习时间**: 从 `answerRecord` 表获取最新的答题时间

## UI 设计

### 颜色系统

- **正确率颜色**:
  - ≥ 80%: 绿色（优秀）
  - 60-79%: 黄色（良好）
  - < 60%: 红色（需要提高）

- **角色徽章**:
  - 管理员: 紫色背景 + 紫色文字
  - 普通用户: 蓝色背景 + 蓝色文字

### 图标使用

- `UsersThree`: 页面标题图标
- `MagnifyingGlass`: 搜索图标
- `User`: 用户头像图标
- `ChartBar`: 学习单词数图标
- `Target`: 平均得分图标
- `Clock`: 最后学习时间图标
- `CaretLeft/CaretRight`: 分页箭头

### 响应式设计

- 表格在小屏幕上可横向滚动
- 搜索栏在移动端占满宽度
- 分页按钮在小屏幕上保持可见

## 性能优化

1. **分页加载**: 每次只加载 20 个用户，避免一次性加载大量数据
2. **搜索防抖**: 搜索时重置页码，避免无效请求
3. **数据缓存**: 使用 React state 缓存当前页数据
4. **懒加载**: 只在需要时加载用户详情

## 错误处理

- 加载失败时显示错误提示
- 网络错误时提供友好的错误信息
- 空状态时显示"暂无用户数据"或"未找到匹配的用户"

## 相关文件

- **前端组件**: `src/pages/admin/UserManagementPage.tsx`
- **后端服务**: `backend/src/services/admin.service.ts`
- **后端路由**: `backend/src/routes/admin.routes.ts`
- **API 客户端**: `src/services/ApiClient.ts`

## 需求验证

✅ **需求 11.1**: 显示所有用户的学习概览
- ✅ 用户ID（用于跳转）
- ✅ 用户名
- ✅ 总学习单词数
- ✅ 平均单词得分
- ✅ 整体正确率
- ✅ 最后学习时间

✅ **支持点击用户查看详细信息**
- ✅ 点击用户行跳转到用户详情页面（`/admin/users/:id`）

## 使用示例

```typescript
// 访问用户管理页面
navigate('/admin/users');

// 搜索用户
setSearchInput('张三');
handleSearch();

// 切换页码
handlePageChange(2);

// 查看用户详情
handleUserClick('user-id-123');
```

## 未来改进

1. 支持按角色筛选（管理员/普通用户）
2. 支持按学习活跃度排序
3. 支持批量操作（批量删除、批量修改角色）
4. 导出用户列表为 CSV/Excel
5. 显示用户学习趋势图表
