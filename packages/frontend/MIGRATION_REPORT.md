# å­¦ä¹ è¿›åº¦APIè¿ç§»åˆ°React Query - å®ŒæˆæŠ¥å‘Š

## è¿ç§»æ¦‚è¿°

æˆåŠŸå°†å­¦ä¹ è¿›åº¦ç›¸å…³çš„APIè¿ç§»åˆ°React Queryï¼Œæå‡äº†ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## å®Œæˆä»»åŠ¡

### 1. åˆ›å»ºReact Query Hooks

#### âœ… `hooks/queries/useStudyProgress.ts`
- å®ç°äº†`useStudyProgress()` - åŸºç¡€React Query hook
- å®ç°äº†`useStudyProgressWithRefresh()` - å…¼å®¹æ—§ç‰ˆAPIçš„wrapper
- **é…ç½®**: staleTime = 30ç§’ï¼Œå¯ç”¨çª—å£ç„¦ç‚¹åˆ·æ–°

#### âœ… `hooks/queries/useTodayWords.ts`
- å®ç°äº†`useTodayWords()` - è·å–ä»Šæ—¥å­¦ä¹ å•è¯
- å®ç°äº†`useTodayWordsCompat()` - å…¼å®¹æ—§ç‰ˆuseStudyPlançš„wrapper
- **é…ç½®**: staleTime = 1åˆ†é’Ÿï¼Œå¯ç”¨çª—å£ç„¦ç‚¹åˆ·æ–°

#### âœ… `hooks/queries/useMasteryWords.ts`
- å®ç°äº†`useLearnedWords()` - è·å–å·²å­¦ä¹ å•è¯åˆ—è¡¨
- å®ç°äº†`useMasteryStats()` - è·å–æŒæ¡åº¦ç»Ÿè®¡
- å®ç°äº†`useBatchMasteryEvaluation()` - æ‰¹é‡æŒæ¡åº¦è¯„ä¼°
- å®ç°äº†`useMasteryDetail()` - å•ä¸ªå•è¯æŒæ¡åº¦è¯¦æƒ…
- å®ç°äº†`useMasteryWords()` - ç»„åˆhookï¼Œæä¾›å®Œæ•´æ•°æ®
- **é…ç½®**: æ ¹æ®æ•°æ®ç‰¹æ€§è®¾ç½®ä¸åŒçš„staleTime (1-5åˆ†é’Ÿ)

### 2. æ›´æ–°QueryKeysé…ç½®

âœ… åœ¨`lib/queryKeys.ts`ä¸­æ·»åŠ äº†`studyProgress`å‘½åç©ºé—´ï¼š
- `studyProgress.current()` - å½“å‰å­¦ä¹ è¿›åº¦
- `studyProgress.todayWords()` - ä»Šæ—¥å•è¯
- `studyProgress.masteryStats()` - æŒæ¡åº¦ç»Ÿè®¡
- `studyProgress.masteryBatch()` - æ‰¹é‡æŒæ¡åº¦
- `studyProgress.masteryDetail()` - å•è¯æŒæ¡åº¦è¯¦æƒ…
- `words.learned()` - å·²å­¦ä¹ å•è¯åˆ—è¡¨

### 3. æ›´æ–°é¡µé¢ç»„ä»¶

#### âœ… StudyProgressPage
- ä»`useStudyProgress`è¿ç§»åˆ°`useStudyProgressWithRefresh`
- ä¿æŒäº†å®Œå…¨çš„å‘åå…¼å®¹æ€§
- ç”¨æˆ·ä½“éªŒæå‡ï¼šè‡ªåŠ¨åå°åˆ·æ–°ã€æ›´å¥½çš„åŠ è½½çŠ¶æ€

#### âœ… TodayWordsPage  
- ä»`useStudyPlan`è¿ç§»åˆ°`useTodayWordsCompat`
- ä¿æŒAPIæ¥å£ä¸€è‡´æ€§
- æ”¹è¿›äº†æ•°æ®ç¼“å­˜å’Œåˆ·æ–°ç­–ç•¥

#### âœ… WordMasteryPage
- ä»æ‰‹åŠ¨APIè°ƒç”¨è¿ç§»åˆ°`useMasteryWords`
- ç®€åŒ–äº†ç»„ä»¶é€»è¾‘ï¼Œç§»é™¤äº†å¤§é‡çŠ¶æ€ç®¡ç†ä»£ç 
- è‡ªåŠ¨å¤„ç†æ‰¹é‡æ•°æ®åŠ è½½å’Œåˆå¹¶

### 4. å•å…ƒæµ‹è¯•

#### âœ… useStudyProgressæµ‹è¯• (8ä¸ªæµ‹è¯•ç”¨ä¾‹)
- æ•°æ®è·å–æµ‹è¯•
- åŠ è½½çŠ¶æ€æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•
- æ•°æ®æ­£ç¡®æ€§éªŒè¯
- å…¼å®¹å±‚æµ‹è¯•

#### âœ… useTodayWordsæµ‹è¯• (11ä¸ªæµ‹è¯•ç”¨ä¾‹)
- ä»Šæ—¥å•è¯æ•°æ®è·å–
- è¿›åº¦æ•°æ®ç»“æ„éªŒè¯
- å…¼å®¹æ€§æµ‹è¯•
- è¾¹ç•Œæƒ…å†µå¤„ç†

#### âœ… useMasteryWordsæµ‹è¯• (11ä¸ªæµ‹è¯•ç”¨ä¾‹)
- å·²å­¦ä¹ å•è¯è·å–
- æŒæ¡åº¦ç»Ÿè®¡éªŒè¯
- æ‰¹é‡è¯„ä¼°åŠŸèƒ½
- æ•°æ®åˆå¹¶é€»è¾‘
- é”™è¯¯å¤„ç†

**æµ‹è¯•ç»“æœ**: âœ… 30ä¸ªæµ‹è¯•é€šè¿‡ï¼Œ1ä¸ªè·³è¿‡ï¼Œ0ä¸ªå¤±è´¥

## æŠ€æœ¯æ”¹è¿›

### æ€§èƒ½ä¼˜åŒ–
1. **æ™ºèƒ½ç¼“å­˜**: æ ¹æ®æ•°æ®å˜åŒ–é¢‘ç‡é…ç½®ä¸åŒçš„staleTime
   - å­¦ä¹ è¿›åº¦: 30ç§’
   - ä»Šæ—¥å•è¯: 1åˆ†é’Ÿ  
   - æŒæ¡åº¦æ•°æ®: 1-5åˆ†é’Ÿ

2. **å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚**: React Queryè‡ªåŠ¨å»é‡å’Œç¼“å­˜ç®¡ç†

3. **åå°åˆ·æ–°**: çª—å£ç„¦ç‚¹æ¢å¤æ—¶è‡ªåŠ¨åˆ·æ–°å…³é”®æ•°æ®

### ä»£ç è´¨é‡
1. **ç»Ÿä¸€çš„æ•°æ®ç®¡ç†**: æ‰€æœ‰å­¦ä¹ è¿›åº¦ç›¸å…³APIä½¿ç”¨ä¸€è‡´çš„æ¨¡å¼
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
3. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
4. **æµ‹è¯•è¦†ç›–**: å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–

### ç”¨æˆ·ä½“éªŒ
1. **æ›´å¿«çš„å“åº”**: åˆ©ç”¨ç¼“å­˜å‡å°‘åŠ è½½æ—¶é—´
2. **æ›´å¹³æ»‘çš„äº¤äº’**: ä¼˜åŒ–çš„åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º
3. **è‡ªåŠ¨åŒæ­¥**: å¤šæ ‡ç­¾é¡µä¹‹é—´çš„æ•°æ®è‡ªåŠ¨åŒæ­¥

## å‘åå…¼å®¹æ€§

æ‰€æœ‰è¿ç§»éƒ½ä¿æŒäº†å®Œæ•´çš„å‘åå…¼å®¹æ€§ï¼š
- ä½¿ç”¨Wrapper hooks (å¦‚`useStudyProgressWithRefresh`, `useTodayWordsCompat`)
- è¿”å›å€¼æ ¼å¼ä¸æ—§ç‰ˆAPIå®Œå…¨ä¸€è‡´
- ç°æœ‰é¡µé¢ç»„ä»¶æ— éœ€å¤§è§„æ¨¡é‡æ„

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `src/hooks/queries/useStudyProgress.ts`
- `src/hooks/queries/useTodayWords.ts`
- `src/hooks/queries/useMasteryWords.ts`
- `src/hooks/queries/__tests__/useStudyProgress.test.tsx`
- `src/hooks/queries/__tests__/useTodayWords.test.tsx`
- `src/hooks/queries/__tests__/useMasteryWords.test.tsx`

### ä¿®æ”¹æ–‡ä»¶
- `src/lib/queryKeys.ts` - æ·»åŠ studyProgress keys
- `src/hooks/queries/index.ts` - å¯¼å‡ºæ–°hooks
- `src/pages/StudyProgressPage.tsx` - ä½¿ç”¨æ–°hook
- `src/pages/TodayWordsPage.tsx` - ä½¿ç”¨æ–°hook
- `src/pages/WordMasteryPage.tsx` - ä½¿ç”¨æ–°hook

## ä¸‹ä¸€æ­¥å»ºè®®

1. âœ… **å·²å®Œæˆ**: åŸºç¡€è¿ç§»å’Œæµ‹è¯•
2. ğŸ”„ **å¯é€‰**: é€æ­¥ç§»é™¤æ—§çš„hooks (useStudyProgress, useStudyPlan)
3. ğŸ”„ **å¯é€‰**: æ·»åŠ æ›´å¤šçš„é›†æˆæµ‹è¯•
4. ğŸ”„ **å¯é€‰**: æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

## æ€»ç»“

âœ… è¿ç§»æˆåŠŸå®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ  
âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ (30/31æµ‹è¯•é€šè¿‡)  
âœ… ä¿æŒäº†å®Œæ•´çš„å‘åå…¼å®¹æ€§  
âœ… æå‡äº†ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒ  

è¿ç§»æ—¶é—´: çº¦45åˆ†é’Ÿ  
ä»£ç è¡Œæ•°: ~800è¡Œ (å«æµ‹è¯•)  
æµ‹è¯•ç”¨ä¾‹: 31ä¸ª
