# å•è¯å­¦ä¹ åº”ç”¨é‡æ„è·¯çº¿å›¾ 2025

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-13
> **è´Ÿè´£å›¢é˜Ÿ**: æŠ€æœ¯æ¶æ„ç»„
> **çŠ¶æ€**: è§„åˆ’ä¸­

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### å½“å‰çŠ¶æ€å¿«ç…§

- **ä»£ç è§„æ¨¡**: åç«¯ 83,620 è¡Œ | å‰ç«¯ ~50,000 è¡Œ | æµ‹è¯• 74,140 è¡Œ
- **æ ¸å¿ƒæ¨¡å—**:
  - `engine.ts`: 2,359 è¡Œ (å•ä¸€èŒè´£è¿å)
  - `amas.service.ts`: 1,607 è¡Œ (ä¸Šå¸ç±»åæ¨¡å¼)
- **æŠ€æœ¯å€ºåŠ¡**:
  - 143 ä¸ªå¤±è´¥æµ‹è¯•å¥—ä»¶
  - 20+ TypeScript ç¼–è¯‘é”™è¯¯
  - å¾ªç¯ä¾èµ–å’Œç´§è€¦åˆ
- **æ¶æ„é—®é¢˜**:
  - æœåŠ¡å±‚è¿‡åº¦è†¨èƒ€ (45ä¸ªæœåŠ¡ç±»)
  - ç¼ºä¹æ¸…æ™°çš„é¢†åŸŸè¾¹ç•Œ
  - ç¼ºä¹ API ç‰ˆæœ¬æ§åˆ¶

### ä¸šåŠ¡å½±å“åˆ†æ

- **å¼€å‘æ•ˆç‡**: æ–°åŠŸèƒ½å¼€å‘å‘¨æœŸå»¶é•¿ 40%
- **ç»´æŠ¤æˆæœ¬**: Bug ä¿®å¤å¹³å‡è€—æ—¶ +35%
- **å›¢é˜Ÿåä½œ**: ä»£ç å†²çªç‡ 25%
- **ç³»ç»Ÿç¨³å®šæ€§**: æœˆå‡ç”Ÿäº§äº‹æ•… 3-5 æ¬¡

### é¢„æœŸæ”¶ç›Š (6ä¸ªæœˆå)

- âœ… å¼€å‘æ•ˆç‡æå‡ **50%**
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° **80%+**
- âœ… ä»£ç å¯ç»´æŠ¤æ€§æå‡ **60%**
- âœ… éƒ¨ç½²é¢‘ç‡æå‡ **3x**
- âœ… å¹³å‡ä¿®å¤æ—¶é—´å‡å°‘ **50%**

---

## ğŸ¯ é‡æ„ä¼˜å…ˆçº§çŸ©é˜µ

### å…³é”®ç»´åº¦è¯„åˆ† (1-10)

| æ¨¡å—/ç»„ä»¶            | å½±å“èŒƒå›´ | æŠ€æœ¯é£é™© | ä¸šåŠ¡ç´§æ€¥åº¦ | ROI | æ€»åˆ†   | ä¼˜å…ˆçº§ |
| -------------------- | -------- | -------- | ---------- | --- | ------ | ------ |
| **AMAS Engine æ‹†åˆ†** | 10       | 9        | 8          | 9   | **36** | ğŸ”´ P0  |
| **AMASService é‡æ„** | 9        | 7        | 9          | 8   | **33** | ğŸ”´ P0  |
| **API ç‰ˆæœ¬æ§åˆ¶**     | 8        | 5        | 7          | 9   | **29** | ğŸŸ¡ P1  |
| **æµ‹è¯•ä½“ç³»é‡å»º**     | 7        | 6        | 8          | 8   | **29** | ğŸŸ¡ P1  |
| **å‰ç«¯ç»„ä»¶åº“**       | 6        | 4        | 6          | 7   | **23** | ğŸŸ¢ P2  |
| **æ•°æ®åº“Schemaæ¼”è¿›** | 5        | 8        | 5          | 6   | **24** | ğŸŸ¢ P2  |
| **ç›‘æ§å¯è§‚æµ‹æ€§**     | 4        | 3        | 7          | 7   | **21** | ğŸŸ¢ P2  |
| **æ–‡æ¡£ä½“ç³»**         | 3        | 2        | 5          | 6   | **16** | ğŸ”µ P3  |

### è¯„åˆ†æ ‡å‡†è¯´æ˜

**å½±å“èŒƒå›´** (1-10):

- 10: æ ¸å¿ƒå¼•æ“,å½±å“å…¨ç³»ç»Ÿ
- 7-9: å…³é”®ä¸šåŠ¡æ¨¡å—
- 4-6: ç‹¬ç«‹åŠŸèƒ½æ¨¡å—
- 1-3: å·¥å…·å’Œè¾…åŠ©åŠŸèƒ½

**æŠ€æœ¯é£é™©** (1-10):

- 10: æé«˜é£é™©,æ— æµ‹è¯•è¦†ç›–
- 7-9: é«˜é£é™©,éƒ¨åˆ†æµ‹è¯•
- 4-6: ä¸­ç­‰é£é™©,æµ‹è¯•è¦†ç›–50%+
- 1-3: ä½é£é™©,æµ‹è¯•å®Œå–„

**ä¸šåŠ¡ç´§æ€¥åº¦** (1-10):

- 10: é˜»å¡æ–°åŠŸèƒ½å¼€å‘
- 7-9: ä¸¥é‡å½±å“å¼€å‘æ•ˆç‡
- 4-6: å½±å“ç”¨æˆ·ä½“éªŒ
- 1-3: ä¼˜åŒ–æ”¹è¿›

**ROI æŠ•èµ„å›æŠ¥** (1-10):

- 10: ç«‹å³è§æ•ˆ,é•¿æœŸé«˜ä»·å€¼
- 7-9: çŸ­æœŸè§æ•ˆ,ä¸­é•¿æœŸä»·å€¼
- 4-6: ä¸­æœŸè§æ•ˆ
- 1-3: é•¿æœŸä»·å€¼

---

## ğŸ—ï¸ Phase 1: æ ¸å¿ƒå¼•æ“è§£è€¦ (æœˆ1-2)

### é‡Œç¨‹ç¢‘: AMAS Engine æ¨¡å—åŒ–é‡æ„

**ç›®æ ‡**: å°† 2,359 è¡Œçš„å·¨å‹ `engine.ts` æ‹†åˆ†ä¸ºæ¸…æ™°çš„èŒè´£æ¨¡å—

#### 1.1 æˆ˜æœ¯æ‹†åˆ†ç­–ç•¥ (Week 1-2)

**å½“å‰é—®é¢˜è¯Šæ–­**:

```typescript
// é—®é¢˜: engine.ts åŒ…å«äº†å¤ªå¤šèŒè´£
// - å¼•æ“ç¼–æ’é€»è¾‘
// - ç±»å‹å®šä¹‰ (400+ è¡Œ)
// - å¼¹æ€§ä¿æŠ¤
// - ç”¨æˆ·éš”ç¦»
// - å»ºæ¨¡å±‚ç®¡ç†
// - å­¦ä¹ å±‚ç®¡ç†
// - æŒä¹…åŒ–ç®¡ç†
// - å†³ç­–è½¨è¿¹è®°å½•
// - ç‰¹å¾å‘é‡æ„å»º
// - å¥–åŠ±é…ç½®ç¼“å­˜
```

**é‡æ„æ¨¡å¼åº”ç”¨**:

##### Extract Class (æå–ç±»)

```typescript
// ç›®æ ‡ç»“æ„:
src/amas/core/
  â”œâ”€â”€ engine.ts                    // æ ¸å¿ƒç¼–æ’ (~300è¡Œ)
  â”œâ”€â”€ types/
  â”‚   â”œâ”€â”€ index.ts                 // ç»Ÿä¸€å¯¼å‡º
  â”‚   â”œâ”€â”€ models.ts                // æ•°æ®æ¨¡å‹
  â”‚   â”œâ”€â”€ interfaces.ts            // æ¥å£å®šä¹‰
  â”‚   â””â”€â”€ enums.ts                 // æšä¸¾å¸¸é‡
  â”œâ”€â”€ orchestration/
  â”‚   â”œâ”€â”€ pipeline-orchestrator.ts // æµæ°´çº¿ç¼–æ’
  â”‚   â”œâ”€â”€ stage-executor.ts        // é˜¶æ®µæ‰§è¡Œå™¨
  â”‚   â””â”€â”€ context-builder.ts       // ä¸Šä¸‹æ–‡æ„å»º
  â”œâ”€â”€ isolation/
  â”‚   â”œâ”€â”€ user-isolation.ts        // ç”¨æˆ·éš”ç¦»
  â”‚   â”œâ”€â”€ state-manager.ts         // çŠ¶æ€ç®¡ç†
  â”‚   â””â”€â”€ model-manager.ts         // æ¨¡å‹ç®¡ç†
  â”œâ”€â”€ resilience/
  â”‚   â”œâ”€â”€ circuit-breaker.ts       // ç†”æ–­å™¨
  â”‚   â”œâ”€â”€ fallback-handler.ts      // é™çº§å¤„ç†
  â”‚   â””â”€â”€ timeout-guard.ts         // è¶…æ—¶ä¿æŠ¤
  â””â”€â”€ telemetry/
      â”œâ”€â”€ decision-tracer.ts       // å†³ç­–è¿½è¸ª
      â”œâ”€â”€ metrics-collector.ts     // æŒ‡æ ‡æ”¶é›†
      â””â”€â”€ performance-monitor.ts   // æ€§èƒ½ç›‘æ§
```

##### Move Method (ç§»åŠ¨æ–¹æ³•)

**æ­¥éª¤ 1**: è¯†åˆ«èŒè´£è¾¹ç•Œ

```typescript
// åˆ†ææ–¹æ³•å½’å±
class AMASEngine {
  // ç¼–æ’èŒè´£ -> ä¿ç•™
  processEvent()

  // ç±»å‹å®šä¹‰ -> è¿ç§»åˆ° types/
  interface UserModels
  interface ProcessOptions

  // å¼¹æ€§ä¿æŠ¤ -> è¿ç§»åˆ° resilience/
  handleCircuitBreaker()
  applyTimeout()

  // è¿½è¸ªè®°å½• -> è¿ç§»åˆ° telemetry/
  recordDecisionTrace()
  collectMetrics()
}
```

**æ­¥éª¤ 2**: æ¸è¿›å¼è¿ç§»

```typescript
// Week 1: ç±»å‹å®šä¹‰è¿ç§»
// 1. åˆ›å»ºæ–°çš„ç±»å‹æ¨¡å—
// 2. ä¿ç•™åŸå§‹ä½ç½®çš„ type alias
// 3. æ›´æ–°å¯¼å…¥è·¯å¾„
// 4. åˆ é™¤åŸå§‹å®šä¹‰

// Week 2: åŠŸèƒ½æ¨¡å—è¿ç§»
// 1. æå–ä¸ºç‹¬ç«‹ç±»
// 2. ä¾èµ–æ³¨å…¥æ”¹é€ 
// 3. å•å…ƒæµ‹è¯•ç¼–å†™
// 4. é›†æˆæµ‹è¯•éªŒè¯
```

#### 1.2 å¼•å…¥ä¾èµ–æ³¨å…¥ (Week 3)

**é—®é¢˜**: ç¡¬ç¼–ç ä¾èµ–,éš¾ä»¥æµ‹è¯•å’Œæ‰©å±•

**è§£å†³æ–¹æ¡ˆ**: IoC å®¹å™¨ + ä¾èµ–æ³¨å…¥

```typescript
// ä½¿ç”¨ tsyringe æˆ– inversify
import { container, injectable, inject } from 'tsyringe';

@injectable()
export class AMASEngine {
  constructor(
    @inject('IStateRepository') private stateRepo: IStateRepository,
    @inject('IModelRepository') private modelRepo: IModelRepository,
    @inject('IPipelineOrchestrator') private orchestrator: IPipelineOrchestrator,
    @inject('IResilienceManager') private resilience: IResilienceManager,
    @inject('ITelemetryCollector') private telemetry: ITelemetryCollector,
  ) {}

  async processEvent(userId: string, event: RawEvent): Promise<ProcessResult> {
    // ç¼–æ’é€»è¾‘
    const context = await this.orchestrator.buildContext(userId, event);
    const result = await this.orchestrator.execute(context);
    await this.telemetry.record(result);
    return result;
  }
}

// é…ç½®å®¹å™¨
container.register<IStateRepository>('IStateRepository', {
  useClass: DatabaseStateRepository,
});
```

#### 1.3 æµ‹è¯•ç­–ç•¥ (Week 4)

**åˆ†å±‚æµ‹è¯•**:

```typescript
// 1. å•å…ƒæµ‹è¯• - éš”ç¦»æµ‹è¯•æ¯ä¸ªæ¨¡å—
describe('PipelineOrchestrator', () => {
  let orchestrator: PipelineOrchestrator;
  let mockStateRepo: jest.Mocked<IStateRepository>;

  beforeEach(() => {
    mockStateRepo = createMockStateRepository();
    orchestrator = new PipelineOrchestrator(mockStateRepo);
  });

  it('should build context with user state', async () => {
    // æµ‹è¯•é€»è¾‘
  });
});

// 2. é›†æˆæµ‹è¯• - æµ‹è¯•æ¨¡å—åä½œ
describe('AMASEngine Integration', () => {
  let engine: AMASEngine;
  let testContainer: DependencyContainer;

  beforeEach(() => {
    testContainer = setupTestContainer();
    engine = testContainer.resolve(AMASEngine);
  });

  it('should process event end-to-end', async () => {
    // æµ‹è¯•é€»è¾‘
  });
});

// 3. å¥‘çº¦æµ‹è¯• - ç¡®ä¿æ¥å£ç¨³å®šæ€§
describe('AMASEngine Contract', () => {
  it('should maintain backward compatibility', () => {
    // éªŒè¯å…¬å…± API ä¸å˜
  });
});
```

**æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**:

- å•å…ƒæµ‹è¯•: **85%+**
- é›†æˆæµ‹è¯•: **70%+**
- å¥‘çº¦æµ‹è¯•: **100%** (æ‰€æœ‰å…¬å…±æ¥å£)

#### 1.4 é£é™©æ§åˆ¶æªæ–½

**å›æ»šç­–ç•¥**:

```typescript
// 1. Feature Toggle - æ–°æ—§å®ç°å¹¶å­˜
const useNewEngine = process.env.USE_NEW_AMAS_ENGINE === 'true';

export function createAMASEngine(): IAMASEngine {
  if (useNewEngine) {
    return container.resolve(NewAMASEngine);
  }
  return new LegacyAMASEngine(); // ä¿ç•™æ—§å®ç°
}

// 2. é‡‘ä¸é›€å‘å¸ƒ - é€æ­¥æ”¾é‡
const canaryUsers = ['user-001', 'user-002']; // 1% ç”¨æˆ·
if (canaryUsers.includes(userId)) {
  return createNewEngine();
}
return createLegacyEngine();
```

**ç›‘æ§æŒ‡æ ‡**:

- å“åº”æ—¶é—´å¯¹æ¯” (P50, P95, P99)
- é”™è¯¯ç‡å˜åŒ–
- å†³ç­–è´¨é‡å¯¹æ¯” (A/B æµ‹è¯•)
- èµ„æºä½¿ç”¨ (å†…å­˜, CPU)

---

## ğŸ”§ Phase 2: æœåŠ¡å±‚é‡æ„ (æœˆ2-3)

### é‡Œç¨‹ç¢‘: AMASService æ‹†åˆ†ä¸èŒè´£æ˜ç¡®

**ç›®æ ‡**: å°† 1,607 è¡Œçš„ `amas.service.ts` é‡æ„ä¸ºé¢†åŸŸé©±åŠ¨çš„æœåŠ¡é›†åˆ

#### 2.1 é¢†åŸŸæ¨¡å‹è¯†åˆ«

**å½“å‰é—®é¢˜**:

```typescript
// AMASService æ‰¿æ‹…äº†è¿‡å¤šèŒè´£:
class AMASService {
  processLearningEvent(); // å­¦ä¹ äº‹ä»¶å¤„ç†
  applyDelayedReward(); // å»¶è¿Ÿå¥–åŠ±
  batchProcessEvents(); // æ‰¹å¤„ç†
  getUserState(); // çŠ¶æ€æŸ¥è¯¢
  resetUser(); // ç”¨æˆ·é‡ç½®
  getColdStartPhase(); // å†·å¯åŠ¨
  persistFeatureVector(); // ç‰¹å¾å‘é‡æŒä¹…åŒ–
  ensureLearningSession(); // ä¼šè¯ç®¡ç†
  getUserStats(); // ç»Ÿè®¡æ•°æ®
  getWordReviewHistory(); // å¤ä¹ å†å²
  calculateWordMasteryDecision(); // æŒæ¡åº¦åˆ¤å®š
  updateRecentEvents(); // äº‹ä»¶ç¼“å­˜
  buildBehaviorSignals(); // è¡Œä¸ºä¿¡å·
  computeDueTs(); // åˆ°æœŸæ—¶é—´
  mapToMasteryLevel(); // æŒæ¡ç­‰çº§æ˜ å°„
  mapToWordState(); // çŠ¶æ€æ˜ å°„
  // ... 20+ æ–¹æ³•
}
```

**DDD é¢†åŸŸæ‹†åˆ†**:

```typescript
// 1. å­¦ä¹ ä¼šè¯é¢†åŸŸ
src/amas/domains/learning-session/
  â”œâ”€â”€ learning-session.service.ts      // ä¼šè¯ç®¡ç†
  â”œâ”€â”€ learning-session.repository.ts   // ä¼šè¯æŒä¹…åŒ–
  â”œâ”€â”€ learning-event-handler.ts        // äº‹ä»¶å¤„ç†
  â””â”€â”€ learning-event.types.ts          // äº‹ä»¶ç±»å‹

// 2. å¥–åŠ±è®¡ç®—é¢†åŸŸ
src/amas/domains/reward/
  â”œâ”€â”€ reward-calculator.service.ts     // å¥–åŠ±è®¡ç®—
  â”œâ”€â”€ delayed-reward.service.ts        // å»¶è¿Ÿå¥–åŠ±
  â”œâ”€â”€ reward-profile.service.ts        // å¥–åŠ±é…ç½®
  â””â”€â”€ reward.types.ts                  // å¥–åŠ±ç±»å‹

// 3. ç”¨æˆ·çŠ¶æ€é¢†åŸŸ
src/amas/domains/user-state/
  â”œâ”€â”€ user-state.service.ts            // çŠ¶æ€ç®¡ç†
  â”œâ”€â”€ user-state.repository.ts         // çŠ¶æ€æŒä¹…åŒ–
  â”œâ”€â”€ user-stats.service.ts            // ç»Ÿè®¡æœåŠ¡
  â””â”€â”€ cold-start.service.ts            // å†·å¯åŠ¨æœåŠ¡

// 4. å•è¯æŒæ¡åº¦é¢†åŸŸ
src/amas/domains/word-mastery/
  â”œâ”€â”€ word-mastery.service.ts          // æŒæ¡åº¦æœåŠ¡
  â”œâ”€â”€ mastery-calculator.ts            // æŒæ¡åº¦è®¡ç®—
  â”œâ”€â”€ review-history.service.ts        // å¤ä¹ å†å²
  â””â”€â”€ forgetting-curve.service.ts      // é—å¿˜æ›²çº¿

// 5. è¡Œä¸ºåˆ†æé¢†åŸŸ
src/amas/domains/behavior-analysis/
  â”œâ”€â”€ flow-detector.service.ts         // å¿ƒæµæ£€æµ‹
  â”œâ”€â”€ emotion-detector.service.ts      // æƒ…ç»ªæ£€æµ‹
  â”œâ”€â”€ behavior-signal.service.ts       // è¡Œä¸ºä¿¡å·
  â””â”€â”€ recent-events.cache.ts           // äº‹ä»¶ç¼“å­˜

// 6. ç‰¹å¾å·¥ç¨‹é¢†åŸŸ
src/amas/domains/feature-engineering/
  â”œâ”€â”€ feature-vector.service.ts        // ç‰¹å¾å‘é‡
  â”œâ”€â”€ feature-builder.ts               // ç‰¹å¾æ„å»º
  â””â”€â”€ feature-persistence.service.ts   // ç‰¹å¾æŒä¹…åŒ–
```

#### 2.2 é‡æ„æ¨¡å¼åº”ç”¨

##### Extract Service (æå–æœåŠ¡)

**ç¤ºä¾‹: å»¶è¿Ÿå¥–åŠ±æœåŠ¡**

```typescript
// ä¹‹å‰: åœ¨ AMASService ä¸­
class AMASService {
  private async computeDueTs(userId, wordId, eventTs) {
    // 70 è¡Œé€»è¾‘
  }

  async applyDelayedReward(userId, reward, sessionId) {
    // 130 è¡Œé€»è¾‘
  }
}

// ä¹‹å: ç‹¬ç«‹çš„é¢†åŸŸæœåŠ¡
@injectable()
export class DelayedRewardService {
  constructor(
    @inject('IRewardCalculator') private calculator: IRewardCalculator,
    @inject('IRewardRepository') private repository: IRewardRepository,
    @inject('IFeatureVectorService') private featureService: IFeatureVectorService,
  ) {}

  async scheduleReward(params: ScheduleRewardParams): Promise<void> {
    const dueDate = await this.calculator.calculateDueDate(params);
    await this.repository.enqueue({ ...params, dueDate });
  }

  async applyReward(params: ApplyRewardParams): Promise<RewardResult> {
    const features = await this.featureService.load(params.answerRecordId);
    return await this.calculator.apply(features, params.reward);
  }
}
```

##### Replace Method with Method Object (æ–¹æ³•å¯¹è±¡)

**ç¤ºä¾‹: æŒæ¡åº¦è®¡ç®—**

```typescript
// ä¹‹å‰: 100+ è¡Œçš„å¤æ‚æ–¹æ³•
async calculateWordMasteryDecision(userId, wordId, isCorrect, responseTime, state) {
  // 1. æŸ¥è¯¢å†å²æ•°æ®
  // 2. è®¡ç®—è®¤çŸ¥å¾—åˆ†
  // 3. è®¡ç®—å†å²å¾—åˆ†
  // 4. è®¡ç®—å½“å‰è¡¨ç°
  // 5. ç»¼åˆåˆ¤å®š
  // ... 100+ è¡Œ
}

// ä¹‹å: æ–¹æ³•å¯¹è±¡æ¨¡å¼
@injectable()
export class WordMasteryCalculator {
  constructor(
    @inject('ILearningStateRepository') private stateRepo: ILearningStateRepository,
    @inject('IAnswerRecordRepository') private answerRepo: IAnswerRecordRepository
  ) {}

  async calculate(params: MasteryCalculationParams): Promise<MasteryDecision> {
    const context = await this.buildContext(params);

    const cognitiveScore = this.calculateCognitiveScore(context);
    const historyScore = this.calculateHistoryScore(context);
    const performanceScore = this.calculatePerformanceScore(context);

    return this.makeDecision({
      cognitiveScore,
      historyScore,
      performanceScore
    });
  }

  private async buildContext(params: MasteryCalculationParams): Promise<MasteryContext> {
    // æ•°æ®å‡†å¤‡é€»è¾‘
  }

  private calculateCognitiveScore(context: MasteryContext): number {
    // è®¤çŸ¥å¾—åˆ†é€»è¾‘ (æ¸…æ™°ç‹¬ç«‹)
  }

  private calculateHistoryScore(context: MasteryContext): number {
    // å†å²å¾—åˆ†é€»è¾‘
  }

  private calculatePerformanceScore(context: MasteryContext): number {
    // è¡¨ç°å¾—åˆ†é€»è¾‘
  }

  private makeDecision(scores: MasteryScores): MasteryDecision {
    // å†³ç­–é€»è¾‘
  }
}
```

#### 2.3 è¿ç§»æ—¶é—´è¡¨

**Week 1-2: é¢†åŸŸè¯†åˆ«ä¸è®¾è®¡**

- [ ] ç»˜åˆ¶é¢†åŸŸè¾¹ç•Œå›¾
- [ ] å®šä¹‰é¢†åŸŸæ¥å£
- [ ] è¯„å®¡è®¾è®¡æ–¹æ¡ˆ
- [ ] ç¼–å†™æŠ€æœ¯è§„èŒƒ

**Week 3-4: æ ¸å¿ƒé¢†åŸŸè¿ç§»**

- [ ] è¿ç§»å­¦ä¹ ä¼šè¯é¢†åŸŸ
- [ ] è¿ç§»å¥–åŠ±è®¡ç®—é¢†åŸŸ
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•éªŒè¯

**Week 5-6: æ‰©å±•é¢†åŸŸè¿ç§»**

- [ ] è¿ç§»ç”¨æˆ·çŠ¶æ€é¢†åŸŸ
- [ ] è¿ç§»å•è¯æŒæ¡åº¦é¢†åŸŸ
- [ ] è¿ç§»è¡Œä¸ºåˆ†æé¢†åŸŸ
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

**Week 7-8: æ”¶å°¾ä¸ä¼˜åŒ–**

- [ ] è¿ç§»ç‰¹å¾å·¥ç¨‹é¢†åŸŸ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£ç¼–å†™
- [ ] ä»£ç è¯„å®¡

#### 2.4 å‘åå…¼å®¹ç­–ç•¥

**é€‚é…å™¨æ¨¡å¼**:

```typescript
// ä¿æŒåŸæœ‰ AMASService æ¥å£ä¸å˜
@injectable()
export class AMASService implements IAMASService {
  constructor(
    @inject('ILearningSessionService') private sessionService: ILearningSessionService,
    @inject('IDelayedRewardService') private rewardService: IDelayedRewardService,
    @inject('IUserStateService') private stateService: IUserStateService,
    @inject('IWordMasteryService') private masteryService: IWordMasteryService,
  ) {}

  // ä¿æŒåŸæœ‰æ–¹æ³•ç­¾å
  async processLearningEvent(userId: string, event: LearningEvent): Promise<ProcessResult> {
    // å§”æ‰˜ç»™æ–°çš„é¢†åŸŸæœåŠ¡
    return await this.sessionService.processEvent(userId, event);
  }

  async applyDelayedReward(
    userId: string,
    reward: number,
    sessionId?: string,
  ): Promise<RewardResult> {
    return await this.rewardService.applyReward({ userId, reward, sessionId });
  }

  // ... å…¶ä»–æ–¹æ³•ç±»ä¼¼
}
```

---

## ğŸŒ Phase 3: API ç‰ˆæœ¬æ§åˆ¶ (æœˆ3-4)

### é‡Œç¨‹ç¢‘: å»ºç«‹ API ç‰ˆæœ¬åŒ–ä½“ç³»

**ç›®æ ‡**: å¼•å…¥ REST API ç‰ˆæœ¬æ§åˆ¶,æ”¯æŒå¹³æ»‘æ¼”è¿›

#### 3.1 ç‰ˆæœ¬åŒ–ç­–ç•¥

**URL è·¯å¾„ç‰ˆæœ¬æ§åˆ¶**:

```typescript
// ç›®å½•ç»“æ„
src/routes/
  â”œâ”€â”€ v1/                           // å½“å‰ç¨³å®šç‰ˆæœ¬
  â”‚   â”œâ”€â”€ learning.routes.ts
  â”‚   â”œâ”€â”€ user.routes.ts
  â”‚   â””â”€â”€ word.routes.ts
  â”œâ”€â”€ v2/                           // æ–°ç‰ˆæœ¬ API
  â”‚   â”œâ”€â”€ learning.routes.ts        // é‡æ„åçš„å­¦ä¹  API
  â”‚   â”œâ”€â”€ user.routes.ts
  â”‚   â””â”€â”€ word.routes.ts
  â””â”€â”€ index.ts                      // ç‰ˆæœ¬è·¯ç”±æ³¨å†Œ

// è·¯ç”±æ³¨å†Œ
app.use('/api/v1', v1Router);
app.use('/api/v2', v2Router);
```

**å“åº”å¤´ç‰ˆæœ¬æ§åˆ¶ (å¤‡é€‰)**:

```typescript
// å®¢æˆ·ç«¯æŒ‡å®šç‰ˆæœ¬
GET /api/learning/events
Headers:
  Accept: application/vnd.danci.v2+json

// æœåŠ¡ç«¯å“åº”
HTTP/1.1 200 OK
Content-Type: application/vnd.danci.v2+json
API-Version: 2.0
```

#### 3.2 v1 â†’ v2 æ¼”è¿›è®¡åˆ’

**Breaking Changes æ¸…å•**:

1. **å­¦ä¹ äº‹ä»¶ API é‡æ„**

```typescript
// v1 (ç°æœ‰)
POST /api/learning/event
{
  "wordId": "string",
  "isCorrect": boolean,
  "responseTime": number,
  "dwellTime": number,
  // 10+ æ‰å¹³å­—æ®µ
}

// v2 (æ”¹è¿›)
POST /api/v2/learning/sessions/{sessionId}/events
{
  "wordId": "string",
  "result": {
    "correct": boolean,
    "responseTimeMs": number
  },
  "interaction": {
    "dwellTimeMs": number,
    "pauseCount": number,
    "retryCount": number
  },
  "context": {
    "pausedTimeMs": number
  }
}
```

2. **å“åº”æ ¼å¼æ ‡å‡†åŒ–**

```typescript
// v1 (ä¸ä¸€è‡´)
{
  "strategy": {...},
  "state": {...},
  "explanation": "string"
}

// v2 (æ ‡å‡†åŒ–)
{
  "data": {
    "strategy": {...},
    "state": {...}
  },
  "meta": {
    "explanation": "string",
    "confidence": 0.95,
    "version": "2.0"
  },
  "links": {
    "self": "/api/v2/learning/events/123",
    "session": "/api/v2/learning/sessions/456"
  }
}
```

3. **é”™è¯¯å“åº”æ ‡å‡†åŒ–**

```typescript
// v2 ç»Ÿä¸€é”™è¯¯æ ¼å¼
{
  "error": {
    "code": "INVALID_EVENT",
    "message": "Learning event validation failed",
    "details": [
      {
        "field": "responseTime",
        "issue": "must be positive integer"
      }
    ]
  },
  "meta": {
    "requestId": "req_123",
    "timestamp": "2025-12-13T10:00:00Z",
    "apiVersion": "2.0"
  }
}
```

#### 3.3 ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ç‰ˆæœ¬ç­–ç•¥**:

- **v1**: ç»´æŠ¤æ¨¡å¼ (ä»…ä¿® bug,18ä¸ªæœˆåå¼ƒç”¨)
- **v2**: æ´»è·ƒå¼€å‘ (æ–°åŠŸèƒ½,æ€§èƒ½ä¼˜åŒ–)
- **v3**: è§„åˆ’ä¸­ (GraphQL æ”¯æŒ)

**å¼ƒç”¨æµç¨‹**:

```typescript
// 1. æ ‡è®°å¼ƒç”¨ (Month 1)
app.use('/api/v1', (req, res, next) => {
  res.setHeader('Deprecation', 'true');
  res.setHeader('Sunset', 'Sat, 31 Dec 2026 23:59:59 GMT');
  res.setHeader('Link', '</api/v2>; rel="successor-version"');
  next();
});

// 2. æ—¥å¿—å‘Šè­¦ (Month 3)
logger.warn('API v1 usage detected', {
  endpoint: req.path,
  user: req.user.id,
  deprecationDate: '2026-12-31',
});

// 3. å¼ºåˆ¶è¿ç§» (Month 18)
app.use('/api/v1', (req, res) => {
  res.status(410).json({
    error: 'API version 1 has been sunset',
    upgradeGuide: 'https://docs.danci.app/api/migration/v1-to-v2',
  });
});
```

#### 3.4 è¿ç§»å·¥å…·

**è‡ªåŠ¨åŒ–è¿ç§»åŠ©æ‰‹**:

```typescript
// æä¾›å·¥å…·ç±»å¸®åŠ©å®¢æˆ·ç«¯è¿ç§»
export class APIVersionAdapter {
  // v1 -> v2 è¯·æ±‚é€‚é…
  static adaptRequestV1ToV2(v1Request: V1LearningEvent): V2LearningEvent {
    return {
      wordId: v1Request.wordId,
      result: {
        correct: v1Request.isCorrect,
        responseTimeMs: v1Request.responseTime,
      },
      interaction: {
        dwellTimeMs: v1Request.dwellTime || 0,
        pauseCount: v1Request.pauseCount || 0,
        retryCount: v1Request.retryCount || 0,
      },
      context: {
        pausedTimeMs: v1Request.pausedTimeMs || 0,
      },
    };
  }

  // v2 -> v1 å“åº”é€‚é… (å‘åå…¼å®¹)
  static adaptResponseV2ToV1(v2Response: V2ProcessResult): V1ProcessResult {
    return {
      strategy: v2Response.data.strategy,
      state: v2Response.data.state,
      explanation: v2Response.meta.explanation,
    };
  }
}
```

---

## ğŸ§ª Phase 4: æµ‹è¯•ä½“ç³»é‡å»º (æœˆ4-5)

### é‡Œç¨‹ç¢‘: å»ºç«‹å…¨é¢çš„æµ‹è¯•é‡‘å­—å¡”

**ç›®æ ‡**: ä» 143 ä¸ªå¤±è´¥æµ‹è¯• â†’ 80%+ è¦†ç›–ç‡çš„å¥åº·æµ‹è¯•å¥—ä»¶

#### 4.1 æµ‹è¯•é‡‘å­—å¡”åˆ†å±‚

```
         /\
        /  \  E2E Tests (10%)
       /____\
      /      \  Integration Tests (30%)
     /________\
    /          \  Unit Tests (60%)
   /____________\
```

**è¦†ç›–ç‡ç›®æ ‡**:

- **å•å…ƒæµ‹è¯•**: 85% (æ ¸å¿ƒé€»è¾‘ 100%)
- **é›†æˆæµ‹è¯•**: 70% (å…³é”®è·¯å¾„ 100%)
- **E2E æµ‹è¯•**: 50% (æ ¸å¿ƒç”¨æˆ·æµç¨‹)

#### 4.2 æµ‹è¯•ç­–ç•¥é‡æ„

##### 4.2.1 å•å…ƒæµ‹è¯•é‡æ„

**å½“å‰é—®é¢˜**:

- æµ‹è¯•ä¾èµ–çœŸå®æ•°æ®åº“ (æ…¢,ä¸ç¨³å®š)
- Mock ä¸å……åˆ† (æµ‹è¯•è„†å¼±)
- æµ‹è¯•è€¦åˆ (ä¸€ä¸ªæ”¹åŠ¨ç ´åå¤šä¸ªæµ‹è¯•)

**è§£å†³æ–¹æ¡ˆ**:

```typescript
// 1. ä½¿ç”¨ Test Fixtures å’Œ Factory Pattern
export class TestDataFactory {
  static createUser(overrides?: Partial<User>): User {
    return {
      id: 'test-user-001',
      email: 'test@example.com',
      username: 'testuser',
      ...overrides,
    };
  }

  static createLearningEvent(overrides?: Partial<LearningEvent>): LearningEvent {
    return {
      wordId: 'word-001',
      isCorrect: true,
      responseTime: 3000,
      timestamp: Date.now(),
      ...overrides,
    };
  }
}

// 2. ä½¿ç”¨ In-Memory Repository
export class InMemoryUserRepository implements IUserRepository {
  private users: Map<string, User> = new Map();

  async save(user: User): Promise<void> {
    this.users.set(user.id, user);
  }

  async findById(id: string): Promise<User | null> {
    return this.users.get(id) || null;
  }
}

// 3. æµ‹è¯•éš”ç¦»
describe('LearningSessionService', () => {
  let service: LearningSessionService;
  let userRepo: InMemoryUserRepository;
  let eventRepo: InMemoryEventRepository;

  beforeEach(() => {
    userRepo = new InMemoryUserRepository();
    eventRepo = new InMemoryEventRepository();
    service = new LearningSessionService(userRepo, eventRepo);
  });

  it('should create session for new user', async () => {
    const user = TestDataFactory.createUser();
    await userRepo.save(user);

    const session = await service.createSession(user.id);

    expect(session).toBeDefined();
    expect(session.userId).toBe(user.id);
  });
});
```

##### 4.2.2 é›†æˆæµ‹è¯•é‡æ„

**ä½¿ç”¨ Testcontainers è¿›è¡ŒçœŸå®æ•°æ®åº“æµ‹è¯•**:

```typescript
import { PostgreSqlContainer } from '@testcontainers/postgresql';

describe('AMASService Integration', () => {
  let container: PostgreSqlContainer;
  let prisma: PrismaClient;
  let service: AMASService;

  beforeAll(async () => {
    // å¯åŠ¨æµ‹è¯•æ•°æ®åº“å®¹å™¨
    container = await new PostgreSqlContainer()
      .withDatabase('test_db')
      .withUsername('test')
      .withPassword('test')
      .start();

    // åˆå§‹åŒ– Prisma
    process.env.DATABASE_URL = container.getConnectionString();
    prisma = new PrismaClient();
    await prisma.$connect();

    // è¿è¡Œè¿ç§»
    execSync('npx prisma migrate deploy');

    // åˆå§‹åŒ–æœåŠ¡
    service = new AMASService(prisma);
  }, 60000);

  afterAll(async () => {
    await prisma.$disconnect();
    await container.stop();
  });

  beforeEach(async () => {
    // æ¸…ç†æ•°æ®
    await prisma.user.deleteMany();
  });

  it('should process learning event end-to-end', async () => {
    const user = await prisma.user.create({
      data: TestDataFactory.createUser(),
    });

    const result = await service.processLearningEvent(
      user.id,
      TestDataFactory.createLearningEvent(),
    );

    expect(result.strategy).toBeDefined();

    // éªŒè¯æ•°æ®åº“çŠ¶æ€
    const savedEvent = await prisma.answerRecord.findFirst({
      where: { userId: user.id },
    });
    expect(savedEvent).toBeDefined();
  });
});
```

##### 4.2.3 E2E æµ‹è¯•

**ä½¿ç”¨ Playwright è¿›è¡Œç”¨æˆ·æµç¨‹æµ‹è¯•**:

```typescript
import { test, expect } from '@playwright/test';

test.describe('Learning Flow', () => {
  test('complete learning session', async ({ page }) => {
    // 1. ç™»å½•
    await page.goto('/login');
    await page.fill('[data-testid=email]', 'test@example.com');
    await page.fill('[data-testid=password]', 'password123');
    await page.click('[data-testid=login-button]');

    // 2. å¼€å§‹å­¦ä¹ ä¼šè¯
    await page.click('[data-testid=start-learning]');
    await expect(page.locator('[data-testid=learning-card]')).toBeVisible();

    // 3. ç­”é¢˜
    await page.click('[data-testid=answer-option-a]');
    await page.click('[data-testid=submit-answer]');

    // 4. éªŒè¯åé¦ˆ
    await expect(page.locator('[data-testid=feedback]')).toContainText('æ­£ç¡®');

    // 5. éªŒè¯çŠ¶æ€æ›´æ–°
    const statsText = await page.locator('[data-testid=session-stats]').textContent();
    expect(statsText).toContain('1/10');
  });
});
```

#### 4.3 æµ‹è¯•åŸºç¡€è®¾æ–½

**CI/CD é›†æˆ**:

```yaml
# .github/workflows/test.yml
name: Test Suite

on: [push, pull_request]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm test:unit
      - uses: codecov/codecov-action@v3
        with:
          file: ./coverage/unit/lcov.info
          flags: unit

  integration-tests:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_PASSWORD: test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm test:integration
      - uses: codecov/codecov-action@v3
        with:
          file: ./coverage/integration/lcov.info
          flags: integration

  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm build
      - run: pnpm test:e2e
      - uses: actions/upload-artifact@v3
        if: failure()
        with:
          name: playwright-screenshots
          path: test-results/
```

**æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š**:

```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: ['node_modules/', 'test/', '**/*.test.ts', '**/*.spec.ts'],
      thresholds: {
        lines: 85,
        functions: 85,
        branches: 80,
        statements: 85,
      },
    },
  },
});
```

#### 4.4 æ—¶é—´è¡¨

**Week 1-2: åŸºç¡€è®¾æ–½æ­å»º**

- [ ] é…ç½® Testcontainers
- [ ] å»ºç«‹ Test Fixtures åº“
- [ ] é…ç½® CI/CD æµæ°´çº¿
- [ ] ç¼–å†™æµ‹è¯•æŒ‡å—æ–‡æ¡£

**Week 3-5: æ ¸å¿ƒæ¨¡å—æµ‹è¯•**

- [ ] AMAS Engine å•å…ƒæµ‹è¯• (300+ æµ‹è¯•ç”¨ä¾‹)
- [ ] æœåŠ¡å±‚é›†æˆæµ‹è¯• (150+ æµ‹è¯•ç”¨ä¾‹)
- [ ] è¦†ç›–ç‡è¾¾åˆ° 70%+

**Week 6-8: å…¨é¢æµ‹è¯•è¦†ç›–**

- [ ] å®Œæˆæ‰€æœ‰æ¨¡å—å•å…ƒæµ‹è¯•
- [ ] E2E æµ‹è¯•è¦†ç›–æ ¸å¿ƒæµç¨‹
- [ ] è¦†ç›–ç‡è¾¾åˆ° 80%+
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ¨ Phase 5: å‰ç«¯é‡æ„ (æœˆ5-6)

### é‡Œç¨‹ç¢‘: React ç»„ä»¶é‡æ„ä¸çŠ¶æ€ç®¡ç†ä¼˜åŒ–

**ç›®æ ‡**: ä»å‘½ä»¤å¼æ··ä¹±ä»£ç  â†’ å£°æ˜å¼æ¸…æ™°æ¶æ„

#### 5.1 ç»„ä»¶åº“å»ºè®¾

**åŸå­è®¾è®¡ç³»ç»Ÿ**:

```
src/components/
  â”œâ”€â”€ atoms/                  // åŸå­ç»„ä»¶
  â”‚   â”œâ”€â”€ Button/
  â”‚   â”œâ”€â”€ Input/
  â”‚   â”œâ”€â”€ Badge/
  â”‚   â””â”€â”€ Icon/
  â”œâ”€â”€ molecules/              // åˆ†å­ç»„ä»¶
  â”‚   â”œâ”€â”€ FormField/
  â”‚   â”œâ”€â”€ SearchBar/
  â”‚   â””â”€â”€ Card/
  â”œâ”€â”€ organisms/              // æœ‰æœºä½“ç»„ä»¶
  â”‚   â”œâ”€â”€ LearningCard/
  â”‚   â”œâ”€â”€ UserProfile/
  â”‚   â””â”€â”€ Dashboard/
  â”œâ”€â”€ templates/              // æ¨¡æ¿
  â”‚   â”œâ”€â”€ LearningPageTemplate/
  â”‚   â””â”€â”€ AdminPageTemplate/
  â””â”€â”€ pages/                  // é¡µé¢
      â”œâ”€â”€ LearningPage/
      â””â”€â”€ AdminPage/
```

**ç»„ä»¶å¼€å‘è§„èŒƒ**:

```typescript
// 1. ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹
interface LearningCardProps {
  wordId: string;
  word: string;
  onAnswer: (isCorrect: boolean) => void;
  disabled?: boolean;
}

// 2. ä½¿ç”¨ React.FC æˆ–å‡½æ•°ç»„ä»¶
export const LearningCard: React.FC<LearningCardProps> = ({
  wordId,
  word,
  onAnswer,
  disabled = false
}) => {
  // 3. ä½¿ç”¨è‡ªå®šä¹‰ Hooks å°è£…é€»è¾‘
  const { options, loading, error } = useLearningOptions(wordId);

  // 4. ä½¿ç”¨ React Query ç®¡ç†æ•°æ®
  const submitAnswerMutation = useSubmitAnswer();

  // 5. äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ useCallback
  const handleAnswer = useCallback((optionId: string) => {
    const isCorrect = options.find(o => o.id === optionId)?.isCorrect;
    submitAnswerMutation.mutate({ wordId, optionId }, {
      onSuccess: () => onAnswer(isCorrect)
    });
  }, [wordId, options, onAnswer]);

  if (loading) return <Skeleton />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <Card>
      <WordDisplay word={word} />
      <OptionList options={options} onSelect={handleAnswer} disabled={disabled} />
    </Card>
  );
};

// 6. ä½¿ç”¨ Storybook è¿›è¡Œç»„ä»¶å¼€å‘
export default {
  title: 'Organisms/LearningCard',
  component: LearningCard,
  parameters: {
    layout: 'centered'
  }
} as Meta;

export const Default: Story = {
  args: {
    wordId: 'word-001',
    word: 'refactor',
    onAnswer: action('onAnswer')
  }
};
```

#### 5.2 çŠ¶æ€ç®¡ç†ä¼˜åŒ–

**ä» Redux â†’ Zustand + React Query**:

```typescript
// ä¹‹å‰: Redux (å†—é•¿,æ ·æ¿ä»£ç å¤š)
// actions/learning.actions.ts
export const submitAnswer = (wordId, answer) => ({
  type: 'SUBMIT_ANSWER',
  payload: { wordId, answer },
});

// reducers/learning.reducer.ts
export const learningReducer = (state, action) => {
  switch (action.type) {
    case 'SUBMIT_ANSWER':
      return { ...state, submitting: true };
    case 'SUBMIT_ANSWER_SUCCESS':
      return { ...state, submitting: false, result: action.payload };
    // ...
  }
};

// ä¹‹å: Zustand (ç®€æ´,ç±»å‹å®‰å…¨)
// stores/learning.store.ts
import { create } from 'zustand';
import { devtools, persist } from 'zustand/middleware';

interface LearningState {
  currentSession: Session | null;
  sessionStats: SessionStats;

  startSession: () => void;
  endSession: () => void;
  resetSession: () => void;
}

export const useLearningStore = create<LearningState>()(
  devtools(
    persist(
      (set, get) => ({
        currentSession: null,
        sessionStats: { wordsCompleted: 0, accuracy: 0 },

        startSession: () => {
          set({
            currentSession: { id: generateId(), startTime: Date.now() },
          });
        },

        endSession: () => {
          set({ currentSession: null });
        },

        resetSession: () => {
          set({ sessionStats: { wordsCompleted: 0, accuracy: 0 } });
        },
      }),
      { name: 'learning-storage' },
    ),
  ),
);

// ä½¿ç”¨ React Query ç®¡ç†æœåŠ¡å™¨çŠ¶æ€
export function useLearningSession(sessionId: string) {
  return useQuery({
    queryKey: ['learning-session', sessionId],
    queryFn: () => api.getSession(sessionId),
    staleTime: 5 * 60 * 1000, // 5 minutes
    refetchOnWindowFocus: false,
  });
}

export function useSubmitAnswer() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: api.submitAnswer,
    onSuccess: (data, variables) => {
      // ä¹è§‚æ›´æ–°
      queryClient.setQueryData(['learning-session', variables.sessionId], (old) => ({
        ...old,
        wordsCompleted: old.wordsCompleted + 1,
      }));
    },
    onError: (error, variables) => {
      // å›æ»š
      queryClient.invalidateQueries({
        queryKey: ['learning-session', variables.sessionId],
      });
    },
  });
}
```

#### 5.3 æ€§èƒ½ä¼˜åŒ–

**1. ä»£ç åˆ†å‰²**:

```typescript
// è·¯ç”±çº§åˆ«æ‡’åŠ è½½
const LearningPage = lazy(() => import('./pages/LearningPage'));
const AdminPage = lazy(() => import('./pages/AdminPage'));

// ç»„ä»¶çº§åˆ«æ¡ä»¶åŠ è½½
const HeavyChart = lazy(() => import('./components/HeavyChart'));

function Dashboard() {
  const [showChart, setShowChart] = useState(false);

  return (
    <div>
      <button onClick={() => setShowChart(true)}>Show Chart</button>
      {showChart && (
        <Suspense fallback={<Spinner />}>
          <HeavyChart />
        </Suspense>
      )}
    </div>
  );
}
```

**2. è™šæ‹Ÿæ»šåŠ¨**:

```typescript
// ä½¿ç”¨ react-window å¤„ç†å¤§åˆ—è¡¨
import { FixedSizeList as List } from 'react-window';

function WordList({ words }: { words: Word[] }) {
  return (
    <List
      height={600}
      itemCount={words.length}
      itemSize={80}
      width="100%"
    >
      {({ index, style }) => (
        <div style={style}>
          <WordCard word={words[index]} />
        </div>
      )}
    </List>
  );
}
```

**3. React.memo ä¼˜åŒ–**:

```typescript
// é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export const WordCard = React.memo<WordCardProps>(
  ({ word, onSelect }) => {
    return (
      <Card onClick={() => onSelect(word.id)}>
        <h3>{word.text}</h3>
        <p>{word.definition}</p>
      </Card>
    );
  },
  (prevProps, nextProps) => {
    // è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘
    return prevProps.word.id === nextProps.word.id;
  }
);
```

#### 5.4 æ—¶é—´è¡¨

**Week 1-2: ç»„ä»¶åº“å»ºè®¾**

- [ ] å»ºç«‹è®¾è®¡ç³»ç»Ÿ
- [ ] å¼€å‘åŸå­/åˆ†å­ç»„ä»¶
- [ ] é…ç½® Storybook
- [ ] ç¼–å†™ç»„ä»¶æ–‡æ¡£

**Week 3-4: æ ¸å¿ƒé¡µé¢é‡æ„**

- [ ] å­¦ä¹ é¡µé¢é‡æ„
- [ ] ç”¨æˆ·ä¸­å¿ƒé‡æ„
- [ ] ç®¡ç†åå°é‡æ„
- [ ] çŠ¶æ€ç®¡ç†è¿ç§»

**Week 5-6: ä¼˜åŒ–ä¸æµ‹è¯•**

- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç»„ä»¶å•å…ƒæµ‹è¯•
- [ ] E2E æµ‹è¯•
- [ ] å¯è®¿é—®æ€§æµ‹è¯•

---

## ğŸ“Š Phase 6: æ•°æ®åº“Schemaæ¼”è¿› (æœˆ6)

### é‡Œç¨‹ç¢‘: å®‰å…¨çš„æ•°æ®åº“è¿ç§»

**ç›®æ ‡**: ä¼˜åŒ–æ•°æ®åº“è®¾è®¡,æ”¯æŒæ–°åŠŸèƒ½,ä¸å½±å“ç”Ÿäº§

#### 6.1 Schema é—®é¢˜è¯†åˆ«

**å½“å‰ç—›ç‚¹**:

1. **æ€§èƒ½é—®é¢˜**: ç¼ºå°‘å…³é”®ç´¢å¼•,æŸ¥è¯¢æ…¢
2. **æ•°æ®å†—ä½™**: æœªè§„èŒƒåŒ–,å­˜åœ¨æ•°æ®ä¸ä¸€è‡´é£é™©
3. **æ‰©å±•æ€§å·®**: ç¡¬ç¼–ç æšä¸¾,éš¾ä»¥æ‰©å±•
4. **ç¼ºå°‘å®¡è®¡**: æ²¡æœ‰åˆ›å»º/æ›´æ–°æ—¶é—´æˆ³

#### 6.2 ä¼˜åŒ–ç­–ç•¥

**1. æ·»åŠ ç´¢å¼•**:

```prisma
// schema.prisma
model AnswerRecord {
  id             String   @id @default(cuid())
  userId         String
  wordId         String
  isCorrect      Boolean
  responseTime   Int
  timestamp      DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  word Word @relation(fields: [wordId], references: [id])

  // æ–°å¢ç´¢å¼•
  @@index([userId, timestamp(sort: Desc)])           // ç”¨æˆ·ç­”é¢˜å†å²æŸ¥è¯¢
  @@index([wordId, userId])                          // å•è¯å¤ä¹ è®°å½•æŸ¥è¯¢
  @@index([timestamp])                               // æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
  @@index([userId, isCorrect])                       // ç”¨æˆ·æ­£ç¡®ç‡ç»Ÿè®¡
  @@unique([userId, wordId, timestamp])              // å¹‚ç­‰æ€§ä¿è¯
}
```

**2. è§„èŒƒåŒ–æ•°æ®ç»“æ„**:

```prisma
// ä¹‹å‰: å†—ä½™å­˜å‚¨
model WordScore {
  userId          String
  wordId          String
  totalScore      Int
  accuracyScore   Int
  speedScore      Int
  stabilityScore  Int
  proficiencyScore Int
  totalAttempts   Int     // å†—ä½™: å¯ä» AnswerRecord è®¡ç®—
  correctAttempts Int     // å†—ä½™: å¯ä» AnswerRecord è®¡ç®—
}

// ä¹‹å: è§†å›¾ + ç¼“å­˜
// ä½¿ç”¨æ•°æ®åº“è§†å›¾å®æ—¶è®¡ç®—
CREATE VIEW word_score_view AS
SELECT
  ar.userId,
  ar.wordId,
  COUNT(*) as totalAttempts,
  SUM(CASE WHEN isCorrect THEN 1 ELSE 0 END) as correctAttempts,
  AVG(responseTime) as avgResponseTime
FROM AnswerRecord ar
GROUP BY ar.userId, ar.wordId;

// Prisma ä¸­ä½¿ç”¨åŸç”ŸæŸ¥è¯¢
model WordScore {
  userId          String
  wordId          String
  totalScore      Int
  accuracyScore   Int
  speedScore      Int
  stabilityScore  Int
  proficiencyScore Int

  // ç§»é™¤å†—ä½™å­—æ®µ,é€šè¿‡å…³è”æŸ¥è¯¢è·å–
  @@map("word_score")
}
```

**3. æšä¸¾æ‰©å±•åŒ–**:

```prisma
// ä¹‹å‰: ç¡¬ç¼–ç æšä¸¾
enum WordState {
  NEW
  LEARNING
  REVIEWING
  MASTERED
}

// ä¹‹å: é…ç½®è¡¨
model WordStateConfig {
  id          String @id @default(cuid())
  code        String @unique  // NEW, LEARNING, etc.
  name        String
  description String?
  color       String?
  order       Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model WordLearningState {
  // ...
  stateCode String
  state WordStateConfig @relation(fields: [stateCode], references: [code])
}
```

**4. å®¡è®¡å­—æ®µ**:

```prisma
// æ·»åŠ æ ‡å‡†å®¡è®¡å­—æ®µ
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique

  // æ–°å¢å®¡è®¡å­—æ®µ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  deletedAt DateTime?  // è½¯åˆ é™¤
}
```

#### 6.3 è¿ç§»ç­–ç•¥

**é›¶åœæœºè¿ç§» (Blue-Green Deployment)**:

```typescript
// æ­¥éª¤ 1: æ·»åŠ æ–°åˆ— (å…¼å®¹æ—§ä»£ç )
// migration-001-add-new-columns.sql
ALTER TABLE answer_record ADD COLUMN response_time_ms INT;
UPDATE answer_record SET response_time_ms = response_time WHERE response_time_ms IS NULL;

// æ­¥éª¤ 2: åŒå†™æœŸ (æ–°æ—§å­—æ®µåŒæ—¶å†™å…¥)
export class AnswerRecordRepository {
  async create(data: CreateAnswerRecordDto): Promise<AnswerRecord> {
    return await prisma.answerRecord.create({
      data: {
        ...data,
        responseTime: data.responseTimeMs,    // æ—§å­—æ®µ (æ¯«ç§’)
        responseTimeMs: data.responseTimeMs   // æ–°å­—æ®µ
      }
    });
  }
}

// æ­¥éª¤ 3: è¿ç§»å†å²æ•°æ® (åå°ä»»åŠ¡)
export async function migrateResponseTimeData() {
  const batchSize = 1000;
  let offset = 0;

  while (true) {
    const records = await prisma.answerRecord.findMany({
      where: { responseTimeMs: null },
      take: batchSize,
      skip: offset
    });

    if (records.length === 0) break;

    await prisma.$transaction(
      records.map(record =>
        prisma.answerRecord.update({
          where: { id: record.id },
          data: { responseTimeMs: record.responseTime }
        })
      )
    );

    offset += batchSize;
  }
}

// æ­¥éª¤ 4: åˆ‡æ¢è¯»å– (éªŒè¯æ–°å­—æ®µ)
export class AnswerRecordRepository {
  async findById(id: string): Promise<AnswerRecord> {
    const record = await prisma.answerRecord.findUnique({ where: { id } });
    return {
      ...record,
      responseTime: record.responseTimeMs || record.responseTime // å›é€€æœºåˆ¶
    };
  }
}

// æ­¥éª¤ 5: åˆ é™¤æ—§åˆ— (è¿ç§»å®Œæˆå)
// migration-005-drop-old-columns.sql
ALTER TABLE answer_record DROP COLUMN response_time;
```

#### 6.4 æ•°æ®å®Œæ•´æ€§ä¿æŠ¤

**ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡å’Œçº¦æŸ**:

```typescript
// 1. äº‹åŠ¡ä¿æŠ¤
export async function updateWordMastery(
  userId: string,
  wordId: string,
  masteryDelta: number
) {
  await prisma.$transaction(async (tx) => {
    // 1. è¯»å–å½“å‰çŠ¶æ€ (å¸¦é”)
    const current = await tx.wordLearningState.findUnique({
      where: { unique_user_word: { userId, wordId } }
    });

    // 2. è®¡ç®—æ–°å€¼
    const newMastery = Math.max(0, Math.min(5, current.masteryLevel + masteryDelta));

    // 3. æ›´æ–°çŠ¶æ€
    await tx.wordLearningState.update({
      where: { unique_user_word: { userId, wordId } },
      data: { masteryLevel: newMastery }
    });

    // 4. è®°å½•å†å²
    await tx.masteryHistory.create({
      data: {
        userId,
        wordId,
        oldLevel: current.masteryLevel,
        newLevel: newMastery,
        delta: masteryDelta
      }
    });
  });
}

// 2. æ•°æ®åº“çº¦æŸ
-- migration.sql
ALTER TABLE word_learning_state
ADD CONSTRAINT mastery_level_range
CHECK (mastery_level >= 0 AND mastery_level <= 5);

ALTER TABLE word_learning_state
ADD CONSTRAINT review_count_positive
CHECK (review_count >= 0);

ALTER TABLE answer_record
ADD CONSTRAINT response_time_positive
CHECK (response_time > 0);
```

---

## ğŸ“ˆ Phase 7: ç›‘æ§ä¸å¯è§‚æµ‹æ€§ (è´¯ç©¿å…¨ç¨‹)

### é‡Œç¨‹ç¢‘: å»ºç«‹å…¨é¢çš„ç›‘æ§ä½“ç³»

**ç›®æ ‡**: ä»ç›²é£ â†’ æ•°æ®é©±åŠ¨çš„å†³ç­–

#### 7.1 ä¸‰å¤§æ”¯æŸ±

**1. æ—¥å¿— (Logging)**:

```typescript
// ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—
import { logger } from './logger';

// ä¹‹å‰: éç»“æ„åŒ–æ—¥å¿—
console.log('User logged in: ' + userId);

// ä¹‹å: ç»“æ„åŒ–æ—¥å¿—
logger.info('User logged in', {
  userId,
  email: user.email,
  loginMethod: 'password',
  ipAddress: req.ip,
  userAgent: req.get('user-agent'),
});

// é”™è¯¯æ—¥å¿—åŒ…å«ä¸Šä¸‹æ–‡
try {
  await service.processEvent(userId, event);
} catch (error) {
  logger.error('Failed to process learning event', {
    error,
    userId,
    eventId: event.id,
    stack: error.stack,
  });
  throw error;
}
```

**2. æŒ‡æ ‡ (Metrics)**:

```typescript
// ä½¿ç”¨ Prometheus å®¢æˆ·ç«¯
import { Counter, Histogram, Gauge } from 'prom-client';

// ä¸šåŠ¡æŒ‡æ ‡
export const learningEventsTotal = new Counter({
  name: 'learning_events_total',
  help: 'Total number of learning events processed',
  labelNames: ['userId', 'isCorrect'],
});

export const learningEventDuration = new Histogram({
  name: 'learning_event_duration_seconds',
  help: 'Duration of learning event processing',
  buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5],
});

export const activeUsers = new Gauge({
  name: 'active_users_total',
  help: 'Number of active users',
});

// ä½¿ç”¨ç¤ºä¾‹
export class LearningService {
  async processEvent(userId: string, event: LearningEvent) {
    const timer = learningEventDuration.startTimer();

    try {
      const result = await this.engine.process(userId, event);

      learningEventsTotal.inc({
        userId,
        isCorrect: event.isCorrect.toString(),
      });

      return result;
    } finally {
      timer();
    }
  }
}
```

**3. è¿½è¸ª (Tracing)**:

```typescript
// ä½¿ç”¨ OpenTelemetry
import { trace, context, SpanStatusCode } from '@opentelemetry/api';

export class AMASService {
  private tracer = trace.getTracer('amas-service');

  async processLearningEvent(userId: string, event: LearningEvent) {
    return await this.tracer.startActiveSpan(
      'processLearningEvent',
      { attributes: { userId, wordId: event.wordId } },
      async (span) => {
        try {
          // 1. æ„ŸçŸ¥å±‚
          const features = await this.traceSpan('perception', () =>
            this.featureBuilder.build(userId, event),
          );

          // 2. å»ºæ¨¡å±‚
          const state = await this.traceSpan('modeling', () =>
            this.updateUserState(userId, features),
          );

          // 3. å­¦ä¹ å±‚
          const action = await this.traceSpan('learning', () =>
            this.bandit.selectAction(state, features),
          );

          // 4. å†³ç­–å±‚
          const strategy = await this.traceSpan('decision', () => this.mapActionToStrategy(action));

          span.setStatus({ code: SpanStatusCode.OK });
          return { strategy, state };
        } catch (error) {
          span.setStatus({
            code: SpanStatusCode.ERROR,
            message: error.message,
          });
          span.recordException(error);
          throw error;
        } finally {
          span.end();
        }
      },
    );
  }

  private async traceSpan<T>(name: string, fn: () => Promise<T>): Promise<T> {
    return await this.tracer.startActiveSpan(name, async (span) => {
      try {
        const result = await fn();
        span.setStatus({ code: SpanStatusCode.OK });
        return result;
      } catch (error) {
        span.recordException(error);
        throw error;
      } finally {
        span.end();
      }
    });
  }
}
```

#### 7.2 ç›‘æ§å¤§ç›˜

**Grafana ä»ªè¡¨ç›˜é…ç½®**:

```yaml
# dashboard.json ç¤ºä¾‹
{
  'dashboard':
    {
      'title': 'AMAS Service Monitoring',
      'panels':
        [
          { 'title': 'Request Rate', 'targets': [{ 'expr': 'rate(learning_events_total[5m])' }] },
          {
            'title': 'Response Time (P95)',
            'targets':
              [{ 'expr': 'histogram_quantile(0.95, learning_event_duration_seconds_bucket)' }],
          },
          {
            'title': 'Error Rate',
            'targets':
              [
                {
                  'expr': 'rate(learning_events_errors_total[5m]) / rate(learning_events_total[5m])',
                },
              ],
          },
          { 'title': 'Active Users', 'targets': [{ 'expr': 'active_users_total' }] },
        ],
    },
}
```

**å‘Šè­¦è§„åˆ™**:

```yaml
# alerts.yml
groups:
  - name: amas_service
    interval: 30s
    rules:
      - alert: HighErrorRate
        expr: |
          rate(learning_events_errors_total[5m])
          /
          rate(learning_events_total[5m])
          > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: 'High error rate detected'
          description: 'Error rate is {{ $value | humanizePercentage }}'

      - alert: SlowResponseTime
        expr: |
          histogram_quantile(0.95,
            rate(learning_event_duration_seconds_bucket[5m])
          ) > 2
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: 'Slow response time detected'
          description: 'P95 latency is {{ $value }}s'

      - alert: DatabaseConnectionPoolExhausted
        expr: database_connections_active >= database_connections_max * 0.9
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: 'Database connection pool near exhaustion'
```

#### 7.3 æ€§èƒ½åŸºå‡†

**å»ºç«‹æ€§èƒ½åŸºçº¿**:

```typescript
// benchmarks/amas-performance.bench.ts
import { describe, bench } from 'vitest';

describe('AMAS Engine Performance', () => {
  bench('processEvent - cold start', async () => {
    await engine.processEvent(newUserId, testEvent);
  });

  bench('processEvent - warm state', async () => {
    await engine.processEvent(existingUserId, testEvent);
  });

  bench('batch process 100 events', async () => {
    await engine.batchProcess(userId, generate100Events());
  });
});

// åŸºçº¿ç»“æœ
/**
 * âœ“ processEvent - cold start: 45ms (ç›®æ ‡: <50ms)
 * âœ“ processEvent - warm state: 12ms (ç›®æ ‡: <20ms)
 * âœ“ batch process 100 events: 850ms (ç›®æ ‡: <1s)
 */
```

---

## ğŸ‘¥ Phase 8: å›¢é˜Ÿåä½œä¸æ–‡æ¡£ (è´¯ç©¿å…¨ç¨‹)

### 8.1 Code Review æ ‡å‡†

**Review Checklist**:

```markdown
## Code Review Checklist

### åŠŸèƒ½æ€§

- [ ] åŠŸèƒ½ç¬¦åˆéœ€æ±‚è§„æ ¼
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•å……åˆ†

### ä»£ç è´¨é‡

- [ ] éµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒ
- [ ] å‡½æ•°å•ä¸€èŒè´£ (â‰¤50è¡Œ)
- [ ] ç±»èŒè´£æ¸…æ™° (â‰¤300è¡Œ)
- [ ] é¿å…é‡å¤ä»£ç  (DRY)
- [ ] å‘½åæ¸…æ™°æœ‰æ„ä¹‰

### æµ‹è¯•è¦†ç›–

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
- [ ] é›†æˆæµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„
- [ ] è¾¹ç•Œæµ‹è¯•å’Œé”™è¯¯æµ‹è¯•
- [ ] æµ‹è¯•å¯è¯»æ€§å¥½

### æ€§èƒ½ä¸å®‰å…¨

- [ ] æ²¡æœ‰æ˜æ˜¾æ€§èƒ½ç“¶é¢ˆ
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] è¾“å…¥éªŒè¯å’Œæ¸…ç†
- [ ] æ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²

### æ–‡æ¡£

- [ ] å…¬å…± API æœ‰ JSDoc
- [ ] å¤æ‚é€»è¾‘æœ‰æ³¨é‡Š
- [ ] README æ›´æ–°
- [ ] å˜æ›´æ—¥å¿—è®°å½•
```

**Review æµç¨‹**:

```mermaid
graph LR
    A[PR åˆ›å»º] --> B{è‡ªåŠ¨æ£€æŸ¥}
    B -->|å¤±è´¥| A
    B -->|é€šè¿‡| C[åˆ†é… Reviewer]
    C --> D[Code Review]
    D -->|éœ€è¦ä¿®æ”¹| E[ä½œè€…ä¿®æ”¹]
    E --> D
    D -->|æ‰¹å‡†| F[åˆå¹¶åˆ°ä¸»åˆ†æ”¯]
```

### 8.2 æ–‡æ¡£ä½“ç³»

**ä¸‰å±‚æ–‡æ¡£æ¶æ„**:

```
docs/
  â”œâ”€â”€ architecture/              # æ¶æ„æ–‡æ¡£
  â”‚   â”œâ”€â”€ system-overview.md
  â”‚   â”œâ”€â”€ amas-engine-design.md
  â”‚   â”œâ”€â”€ api-design.md
  â”‚   â””â”€â”€ database-design.md
  â”œâ”€â”€ development/               # å¼€å‘æŒ‡å—
  â”‚   â”œâ”€â”€ setup.md
  â”‚   â”œâ”€â”€ coding-standards.md
  â”‚   â”œâ”€â”€ testing-guide.md
  â”‚   â””â”€â”€ deployment-guide.md
  â””â”€â”€ api/                       # API æ–‡æ¡£
      â”œâ”€â”€ v1/
      â”‚   â”œâ”€â”€ learning-api.md
      â”‚   â””â”€â”€ user-api.md
      â””â”€â”€ v2/
          â”œâ”€â”€ learning-api.md
          â””â”€â”€ user-api.md
```

**ADR (Architecture Decision Records)**:

```markdown
# ADR-001: ä½¿ç”¨ LinUCB ä½œä¸ºæ ¸å¿ƒå­¦ä¹ ç®—æ³•

## Status

Accepted (2025-01-15)

## Context

æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªè‡ªé€‚åº”å­¦ä¹ ç®—æ³•æ¥ä¼˜åŒ–å­¦ä¹ ç­–ç•¥æ¨èã€‚

å€™é€‰æ–¹æ¡ˆ:

1. Multi-Armed Bandit (ç®€å•ä½†ä¸è€ƒè™‘ä¸Šä¸‹æ–‡)
2. LinUCB (è€ƒè™‘ä¸Šä¸‹æ–‡,ç†è®ºä¿è¯)
3. Deep Q-Network (å¤æ‚,éœ€è¦å¤§é‡æ•°æ®)

## Decision

é€‰æ‹© LinUCB (Linear Upper Confidence Bound) ç®—æ³•

### ç†ç”±:

- âœ… è€ƒè™‘ç”¨æˆ·ä¸Šä¸‹æ–‡ç‰¹å¾ (æ³¨æ„åŠ›,ç–²åŠ³åº¦ç­‰)
- âœ… æœ‰ç†è®ºä¿è¯ (regret bound)
- âœ… åœ¨çº¿å­¦ä¹ ,æ— éœ€ç¦»çº¿è®­ç»ƒ
- âœ… å®ç°å¤æ‚åº¦é€‚ä¸­
- âœ… å¯è§£é‡Šæ€§å¥½

## Consequences

### æ­£é¢å½±å“:

- ä¸ªæ€§åŒ–æ¨èæ•ˆæœæå‡ 30%+
- ç®—æ³•å¯è§£é‡Š,ä¾¿äºè°ƒè¯•

### è´Ÿé¢å½±å“:

- éœ€è¦ç»´æŠ¤ç‰¹å¾å‘é‡
- éœ€è¦å®šæœŸæ›´æ–°æ¨¡å‹å‚æ•°
- å†·å¯åŠ¨ç”¨æˆ·æ¨èæ•ˆæœä¸€èˆ¬

## Alternatives Considered

è§ Context éƒ¨åˆ†

## References

- [LinUCB è®ºæ–‡](https://arxiv.org/abs/1003.0146)
- [å®ç°å‚è€ƒ](https://github.com/xxx/linucb)
```

### 8.3 çŸ¥è¯†åˆ†äº«

**æŠ€æœ¯åˆ†äº«ä¼š**:

- **é¢‘ç‡**: æ¯ä¸¤å‘¨ä¸€æ¬¡
- **å½¢å¼**: æŠ€æœ¯æ¼”è®² + Q&A
- **ä¸»é¢˜ç¤ºä¾‹**:
  - Week 2: "AMAS Engine æ¶æ„æ·±åº¦è§£æ"
  - Week 4: "React Query æœ€ä½³å®è·µ"
  - Week 6: "æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–å®æˆ˜"
  - Week 8: "æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD) å·¥ä½œåŠ"

**Pair Programming**:

- é‡æ„å…³é”®æ¨¡å—æ—¶ä½¿ç”¨
- æ–°äºº onboarding ä½¿ç”¨
- è·¨å›¢é˜Ÿåä½œä½¿ç”¨

---

## ğŸ“… æ€»ä½“æ—¶é—´è§„åˆ’

### Gantt å›¾

```
Month 1: |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| AMAS Engine æ‹†åˆ†
Month 2: |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| AMASService é‡æ„
Month 3: |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ------| API ç‰ˆæœ¬æ§åˆ¶
Month 4: |------â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| æµ‹è¯•ä½“ç³»é‡å»º
Month 5: |------â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| å‰ç«¯é‡æ„
Month 6: |------â–ˆâ–ˆâ–ˆâ–ˆ--| æ•°æ®åº“Schemaæ¼”è¿›
å…¨ç¨‹:    |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| ç›‘æ§ä¸æ–‡æ¡£
```

### é‡Œç¨‹ç¢‘æ—¥æœŸ

| é‡Œç¨‹ç¢‘               | å®Œæˆæ—¥æœŸ   | å¯äº¤ä»˜æˆæœ           |
| -------------------- | ---------- | -------------------- |
| **M1: Engine è§£è€¦**  | 2025-02-15 | æ¨¡å—åŒ–çš„ AMAS Engine |
| **M2: Service æ‹†åˆ†** | 2025-03-15 | é¢†åŸŸé©±åŠ¨çš„æœåŠ¡å±‚     |
| **M3: API v2**       | 2025-04-15 | ç‰ˆæœ¬åŒ– API ä½“ç³»      |
| **M4: æµ‹è¯•è¦†ç›–**     | 2025-05-15 | 80%+ æµ‹è¯•è¦†ç›–ç‡      |
| **M5: å‰ç«¯é‡æ„**     | 2025-06-15 | ç»„ä»¶åŒ–å‰ç«¯æ¶æ„       |
| **M6: ç”Ÿäº§å°±ç»ª**     | 2025-06-30 | å…¨é¢ç›‘æ§,æ–‡æ¡£å®Œå–„    |

---

## ğŸ’° èµ„æºéœ€æ±‚

### äººåŠ›èµ„æº

| è§’è‰²           | äººæ•° | æŠ•å…¥åº¦ | æ€»äººæœˆ        |
| -------------- | ---- | ------ | ------------- |
| é«˜çº§åç«¯å·¥ç¨‹å¸ˆ | 2    | 100%   | 12            |
| å‰ç«¯å·¥ç¨‹å¸ˆ     | 1    | 100%   | 6             |
| æµ‹è¯•å·¥ç¨‹å¸ˆ     | 1    | 50%    | 3             |
| DevOps å·¥ç¨‹å¸ˆ  | 1    | 25%    | 1.5           |
| æŠ€æœ¯ Leader    | 1    | 30%    | 1.8           |
| **æ€»è®¡**       | -    | -      | **24.3 äººæœˆ** |

### é¢„ç®—ä¼°ç®—

| é¡¹ç›®     | è´¹ç”¨ (RMB)   | è¯´æ˜                       |
| -------- | ------------ | -------------------------- |
| äººåŠ›æˆæœ¬ | Â¥240,000     | 24.3 äººæœˆ Ã— Â¥10k/æœˆ        |
| äº‘æœåŠ¡   | Â¥12,000      | æµ‹è¯•ç¯å¢ƒ + ç›‘æ§å·¥å…·        |
| å·¥å…·è®¸å¯ | Â¥8,000       | Storybook Cloud, Sentry ç­‰ |
| åŸ¹è®­è´¹ç”¨ | Â¥5,000       | æŠ€æœ¯åŸ¹è®­                   |
| åº”æ€¥é¢„ç®— | Â¥15,000      | 10% ç¼“å†²                   |
| **æ€»è®¡** | **Â¥280,000** | -                          |

---

## âš ï¸ é£é™©ç®¡ç†

### é£é™©çŸ©é˜µ

| é£é™©                 | æ¦‚ç‡ | å½±å“ | ç­‰çº§  | åº”å¯¹ç­–ç•¥                   |
| -------------------- | ---- | ---- | ----- | -------------------------- |
| **æ ¸å¿ƒæ¨¡å—é‡æ„å¤±è´¥** | ä½   | é«˜   | ğŸŸ¡ ä¸­ | Feature Toggle + å›æ»šè®¡åˆ’  |
| **æµ‹è¯•è¦†ç›–ç‡ä¸è¾¾æ ‡** | ä¸­   | ä¸­   | ğŸŸ¡ ä¸­ | å¼ºåˆ¶æµ‹è¯•å…ˆè¡Œ,é—¨ç¦æ£€æŸ¥      |
| **æ•°æ®åº“è¿ç§»å¤±è´¥**   | ä½   | é«˜   | ğŸŸ¡ ä¸­ | å¤šé˜¶æ®µè¿ç§» + å›æ»šè„šæœ¬      |
| **API ä¸å…¼å®¹**       | ä¸­   | é«˜   | ğŸ”´ é«˜ | ä¸¥æ ¼å¥‘çº¦æµ‹è¯• + é•¿æœŸæ”¯æŒ v1 |
| **æ€§èƒ½å›å½’**         | ä¸­   | ä¸­   | ğŸŸ¡ ä¸­ | æŒç»­æ€§èƒ½ç›‘æ§ + åŸºå‡†æµ‹è¯•    |
| **å›¢é˜Ÿäººå‘˜æµåŠ¨**     | ä¸­   | ä¸­   | ğŸŸ¡ ä¸­ | æ–‡æ¡£å®Œå–„ + çŸ¥è¯†åˆ†äº«        |
| **è¿›åº¦å»¶æœŸ**         | é«˜   | ä¸­   | ğŸŸ¡ ä¸­ | æ¯å‘¨ Stand-up + æ•æ·è¿­ä»£   |

### ç¼“è§£æªæ–½

**æŠ€æœ¯é£é™©ç¼“è§£**:

1. **Feature Toggle**: æ–°æ—§å®ç°å…±å­˜,å¿«é€Ÿå›æ»š
2. **é‡‘ä¸é›€å‘å¸ƒ**: é€æ­¥æ”¾é‡,ç›‘æ§æŒ‡æ ‡
3. **ç°åº¦æµ‹è¯•**: å†…éƒ¨ç”¨æˆ·å…ˆè¡ŒéªŒè¯
4. **æ€§èƒ½åŸºå‡†**: æ¯ä¸ª PR è¿è¡Œæ€§èƒ½æµ‹è¯•
5. **Contract Testing**: ç¡®ä¿ API å…¼å®¹æ€§

**é¡¹ç›®é£é™©ç¼“è§£**:

1. **æ¯æ—¥ Stand-up**: å¿«é€ŸåŒæ­¥è¿›å±•å’Œé—®é¢˜
2. **åŒå‘¨ Sprint**: æ•æ·è¿­ä»£,åŠæ—¶è°ƒæ•´
3. **ä»£ç è¯„å®¡**: å¼ºåˆ¶ Review,ä¿è¯è´¨é‡
4. **ç»“å¯¹ç¼–ç¨‹**: å…³é”®æ¨¡å—åŒäººåä½œ
5. **çŸ¥è¯†åˆ†äº«**: å®šæœŸæŠ€æœ¯åˆ†äº«,é™ä½ä¾èµ–

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡ (KPI)

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡                   | å½“å‰å€¼           | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³•       |
| ---------------------- | ---------------- | ------ | -------------- |
| **æµ‹è¯•è¦†ç›–ç‡**         | 40%              | 80%+   | Codecov        |
| **ä»£ç å¯ç»´æŠ¤æ€§**       | C çº§             | A çº§   | SonarQube      |
| **å¹³å‡å“åº”æ—¶é—´ (P95)** | 500ms            | 200ms  | Prometheus     |
| **é”™è¯¯ç‡**             | 2%               | <0.5%  | Sentry         |
| **æŠ€æœ¯å€ºåŠ¡**           | 143 failed tests | 0      | CI/CD          |
| **æ„å»ºæ—¶é—´**           | 8min             | <5min  | GitHub Actions |
| **éƒ¨ç½²é¢‘ç‡**           | 1æ¬¡/æœˆ           | 3æ¬¡/å‘¨ | GitLab         |

### ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡                    | å½“å‰å€¼   | ç›®æ ‡å€¼  | æµ‹é‡æ–¹æ³•            |
| ----------------------- | -------- | ------- | ------------------- |
| **å¼€å‘æ•ˆç‡**            | Baseline | +50%    | Story Points/Sprint |
| **Bug ä¿®å¤æ—¶é—´**        | 2å¤©      | 1å¤©     | JIRA                |
| **æ–°åŠŸèƒ½äº¤ä»˜å‘¨æœŸ**      | 4å‘¨      | 2å‘¨     | JIRA                |
| **ç”Ÿäº§äº‹æ•… (SEV1)**     | 3æ¬¡/æœˆ   | <1æ¬¡/æœˆ | äº‹æ•…æŠ¥å‘Š            |
| **å¹³å‡æ¢å¤æ—¶é—´ (MTTR)** | 2å°æ—¶    | 30åˆ†é’Ÿ  | PagerDuty           |
| **å›¢é˜Ÿæ»¡æ„åº¦**          | 6/10     | 8/10    | å­£åº¦è°ƒæŸ¥            |

---

## ğŸ“ ç»éªŒæ•™è®­ä¸æœ€ä½³å®è·µ

### é‡æ„åŸåˆ™

1. **æ¸è¿›å¼é‡æ„**: é¿å…"å¤§çˆ†ç‚¸"å¼é‡å†™
2. **æµ‹è¯•å…ˆè¡Œ**: é‡æ„å‰è¡¥å……æµ‹è¯•,ä¿è¯å®‰å…¨ç½‘
3. **å‘åå…¼å®¹**: å°½å¯èƒ½ä¿æŒ API ç¨³å®š
4. **ä»£ç è¯„å®¡**: é‡æ„ä»£ç å¼ºåˆ¶ Review
5. **ç›‘æ§é©±åŠ¨**: ç”¨æ•°æ®éªŒè¯é‡æ„æ•ˆæœ

### å¸¸è§é™·é˜±

âŒ **ä¸è¦**:

- æ²¡æœ‰æµ‹è¯•å°±é‡æ„
- åŒæ—¶é‡æ„å¤šä¸ªæ¨¡å—
- å¿½è§†æ€§èƒ½å½±å“
- çœç•¥æ–‡æ¡£æ›´æ–°
- è·³è¿‡ Code Review

âœ… **è¦**:

- å°æ­¥å¿«è·‘,æŒç»­é›†æˆ
- å»ºç«‹å›æ»šæœºåˆ¶
- ç›‘æ§å…³é”®æŒ‡æ ‡
- åŠæ—¶åŒæ­¥å›¢é˜Ÿ
- åº†ç¥é‡Œç¨‹ç¢‘

---

## ğŸ“š å‚è€ƒèµ„æº

### æ¨èä¹¦ç±

- ã€Šé‡æ„:æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ (Martin Fowler)
- ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ (Eric Evans)
- ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹ (Chris Richardson)
- ã€Šæµ‹è¯•é©±åŠ¨å¼€å‘ã€‹ (Kent Beck)

### åœ¨çº¿èµ„æº

- [Refactoring Guru](https://refactoring.guru/) - é‡æ„æ¨¡å¼
- [DDD Patterns](https://www.domainlanguage.com/ddd/) - DDD å®è·µ
- [12 Factor App](https://12factor.net/) - ç°ä»£åº”ç”¨æ–¹æ³•è®º
- [Martin Fowler's Bliki](https://martinfowler.com/bliki/) - æ¶æ„åšå®¢

### å·¥å…·é“¾

- **ä»£ç è´¨é‡**: SonarQube, ESLint, Prettier
- **æµ‹è¯•**: Vitest, Playwright, Testcontainers
- **ç›‘æ§**: Prometheus, Grafana, OpenTelemetry
- **æ–‡æ¡£**: Docusaurus, Storybook, Swagger
- **CI/CD**: GitHub Actions, Docker, Kubernetes

---

## ğŸš€ å¼€å§‹è¡ŒåŠ¨

### ä¸‹ä¸€æ­¥

1. **Week 1**: ç»„ç»‡æŠ€æœ¯è¯„å®¡ä¼šè®®,è®¨è®ºæœ¬è·¯çº¿å›¾
2. **Week 2**: æˆç«‹é‡æ„å·¥ä½œç»„,åˆ†é… Owner
3. **Week 3**: å¯åŠ¨ Phase 1 (AMAS Engine æ‹†åˆ†)
4. **Week 4**: å»ºç«‹ç›‘æ§åŸºç¡€è®¾æ–½

### è”ç³»æ–¹å¼

- **æŠ€æœ¯ Leader**: [é¢†å¯¼é‚®ç®±]
- **Slack Channel**: #refactor-2025
- **Wiki**: [confluence link]
- **é—®é¢˜è¿½è¸ª**: [JIRA board link]

---

**æœ€åæ›´æ–°**: 2025-12-13
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: å¾…è¯„å®¡ â†’ å¾…æ‰¹å‡† â†’ æ‰§è¡Œä¸­

---

## é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­       | å®šä¹‰                                                      |
| ---------- | --------------------------------------------------------- |
| **AMAS**   | Adaptive Multi-Armed Bandit System (è‡ªé€‚åº”å¤šè‡‚è€è™æœºç³»ç»Ÿ) |
| **LinUCB** | Linear Upper Confidence Bound (çº¿æ€§ç½®ä¿¡ä¸Šç•Œç®—æ³•)          |
| **DDD**    | Domain-Driven Design (é¢†åŸŸé©±åŠ¨è®¾è®¡)                       |
| **IoC**    | Inversion of Control (æ§åˆ¶åè½¬)                           |
| **MTTR**   | Mean Time To Recovery (å¹³å‡æ¢å¤æ—¶é—´)                      |
| **P95**    | 95th Percentile (95 åˆ†ä½æ•°)                               |

### B. é‡æ„ Checklist æ¨¡æ¿

```markdown
## é‡æ„ä»»åŠ¡: [æ¨¡å—åç§°]

### å‰ç½®æ¡ä»¶

- [ ] ç°æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½åŸºçº¿å»ºç«‹
- [ ] å›æ»šæ–¹æ¡ˆå‡†å¤‡
- [ ] å›¢é˜Ÿè¯„å®¡å®Œæˆ

### é‡æ„æ­¥éª¤

- [ ] Step 1: [å…·ä½“æ­¥éª¤]
- [ ] Step 2: [å…·ä½“æ­¥éª¤]
- [ ] ...

### éªŒè¯æ¸…å•

- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ (è¦†ç›–ç‡ â‰¥85%)
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•æ— å›å½’
- [ ] Code Review æ‰¹å‡†
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

### ä¸Šçº¿è®¡åˆ’

- [ ] Feature Toggle é…ç½®
- [ ] ç°åº¦å‘å¸ƒ (1% â†’ 10% â†’ 100%)
- [ ] ç›‘æ§æŒ‡æ ‡æ­£å¸¸
- [ ] æ¸…ç†æ—§ä»£ç  (1å‘¨å)
```

---

**å¤‡æ³¨**: æœ¬è·¯çº¿å›¾ä¸ºæ´»æ–‡æ¡£,å°†æ ¹æ®å®é™…è¿›å±•å®šæœŸæ›´æ–°ã€‚æ¬¢è¿å›¢é˜Ÿæˆå‘˜æå‡ºå»ºè®®å’Œæ”¹è¿›æ„è§ã€‚
