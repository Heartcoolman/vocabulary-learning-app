# 代码审查检查清单

> **版本**: v1.0.0
> **最后更新**: 2025-12-13
> **适用场景**: Pull Request审查、代码提交前自查

---

## 使用说明

本检查清单整合了七个审查维度的核心检查项。根据变更类型选择相应的检查项进行审查。

### 图例

- 🔴 **阻断级** - 必须通过才能合并
- 🟡 **警告级** - 建议修复
- 🟢 **建议级** - 可选优化

---

## 1. 自动化检查 🔴

在进行人工审查前，确保以下自动化检查已通过：

### 提交前运行

```bash
# 1. 代码格式化
pnpm format:check

# 2. 代码检查
pnpm lint

# 3. 类型检查
pnpm build

# 4. 单元测试
pnpm test

# 5. 测试覆盖率
pnpm test:coverage
```

### CI自动检查

- [ ] 🔴 Prettier格式检查通过
- [ ] 🔴 ESLint代码质量检查通过
- [ ] 🔴 TypeScript编译无错误
- [ ] 🔴 所有单元测试通过
- [ ] 🔴 测试覆盖率 >= 80%
- [ ] 🔴 `npm audit`无高危漏洞

---

## 2. React代码审查 (组件变更)

### 组件设计

- [ ] 🔴 组件功能单一，代码 < 300行
- [ ] 🔴 Props有明确的TypeScript类型定义
- [ ] 🟡 Props数量合理( <= 10个)
- [ ] 🟡 使用组合模式而非继承

### Hooks使用

- [ ] 🔴 Hooks只在顶层调用，不在条件/循环中
- [ ] 🔴 useEffect依赖数组完整
- [ ] 🔴 有副作用的effect返回清理函数
- [ ] 🟡 昂贵计算使用useMemo优化
- [ ] 🟡 传给React.memo组件的回调使用useCallback

### 状态管理

- [ ] 🔴 状态最小化，派生数据通过计算获得
- [ ] 🟡 状态更新使用函数式更新
- [ ] 🟡 共享状态合理提升或使用Context

### 性能

- [ ] 🟡 纯组件使用React.memo
- [ ] 🟡 长列表使用虚拟化(react-window)
- [ ] 🟡 列表使用稳定的key(非index)

### 测试

- [ ] 🔴 组件有测试覆盖
- [ ] 🟡 测试涵盖主要Props变化
- [ ] 🟡 测试涵盖用户交互

---

## 3. 性能审查 (核心功能变更)

### Bundle大小

- [ ] 🔴 主Bundle < 200KB (gzipped)
- [ ] 🔴 单个异步Chunk < 100KB (gzipped)
- [ ] 🟡 运行`pnpm build`检查bundle大小警告

### 加载性能

- [ ] 🔴 Core Web Vitals达标:
  - LCP < 2.5s
  - FID < 100ms
  - CLS < 0.1
- [ ] 🟡 关键资源使用preload
- [ ] 🟡 非首屏图片使用lazy loading

### 渲染性能

- [ ] 🟡 使用React DevTools Profiler检测过度渲染
- [ ] 🟡 动画使用transform/opacity(不触发layout)
- [ ] 🟡 大数据处理考虑Web Worker

### 缓存策略

- [ ] 🟡 API数据使用React Query缓存
- [ ] 🟡 用户设置存储在LocalStorage
- [ ] 🟡 预加载用户可能访问的数据

---

## 4. 安全审查 (API/认证变更)

### XSS防护

- [ ] 🔴 所有用户输入转义后输出(React自动)
- [ ] 🔴 不使用dangerouslySetInnerHTML(或已sanitize)
- [ ] 🔴 外部链接URL验证协议
- [ ] 🟡 CSP策略正确配置

### 认证授权

- [ ] 🔴 JWT使用强密钥(32+字符)
- [ ] 🔴 密码使用bcrypt加密(10+轮salt)
- [ ] 🔴 生产环境强制HTTPS
- [ ] 🔴 所有敏感操作检查权限
- [ ] 🟡 实现登录速率限制

### 数据保护

- [ ] 🔴 所有输入使用Zod验证
- [ ] 🔴 API端点有速率限制
- [ ] 🔴 Prisma自动防护SQL注入
- [ ] 🟡 敏感数据传输加密

### 配置安全

- [ ] 🔴 敏感信息存储在环境变量
- [ ] 🔴 .env文件不提交到Git
- [ ] 🔴 CORS严格限制允许的源
- [ ] 🟡 错误信息不泄露敏感细节

### 依赖安全

- [ ] 🔴 `pnpm audit`无高危漏洞
- [ ] 🟡 定期更新依赖(每周)

---

## 5. 架构审查 (架构变更)

### 分层架构

- [ ] 🔴 职责分离: Routes → Services → Repositories
- [ ] 🔴 单向依赖，无循环依赖
- [ ] 🟡 层间通过接口通信

### 模块化

- [ ] 🟡 模块高内聚、低耦合
- [ ] 🟡 每个模块单一职责
- [ ] 🟡 公共代码合理抽取

### API设计

- [ ] 🔴 RESTful规范正确
- [ ] 🔴 API版本化(/api/v1/)
- [ ] 🔴 统一的错误响应格式
- [ ] 🔴 正确使用HTTP状态码

### 设计模式

- [ ] 🟡 合理使用设计模式
- [ ] 🟡 避免过度设计

---

## 6. 测试审查

### 测试覆盖

- [ ] 🔴 新增代码测试覆盖率 >= 80%
- [ ] 🔴 核心功能100%覆盖
- [ ] 🔴 所有测试通过
- [ ] 🟡 测试涵盖边界和异常情况

### 测试质量

- [ ] 🟡 测试独立，互不依赖
- [ ] 🟡 测试描述清晰
- [ ] 🟡 Mock使用合理，不过度Mock

### 测试类型

- [ ] 🟡 单元测试: 纯函数、工具类
- [ ] 🟡 集成测试: API端点
- [ ] 🟡 E2E测试: 核心用户流程

---

## 7. 文档审查

### 代码注释

- [ ] 🟡 复杂函数有JSDoc注释
- [ ] 🟡 复杂算法有步骤说明
- [ ] 🟡 TODO标记清晰

### 文档更新

- [ ] 🟡 README更新(如有新功能)
- [ ] 🟡 API文档更新(如有API变更)
- [ ] 🟡 CHANGELOG记录变更

### 接口文档

- [ ] 🟡 新API有完整文档(请求/响应示例)
- [ ] 🟡 破坏性变更有迁移指南

---

## 8. 合规性检查

### 许可证

- [ ] 🔴 新依赖许可证兼容
- [ ] 🟡 代码文件有版权声明

### 可访问性

- [ ] 🟡 新组件符合WCAG 2.1 AA
- [ ] 🟡 语义化HTML标签
- [ ] 🟡 键盘可访问
- [ ] 🟡 重要元素有aria标签

### 浏览器兼容性

- [ ] 🟡 在目标浏览器测试通过
- [ ] 🟡 必要时使用Polyfill

### 移动端适配

- [ ] 🟡 响应式设计适配
- [ ] 🟡 触摸目标 >= 44x44px

---

## 专项审查检查清单

根据变更类型选择对应的专项检查清单：

### A. 组件变更检查清单

```
✓ 自动化检查 (第1节)
✓ React代码审查 (第2节)
✓ 测试审查 - 组件测试 (第6节)
✓ 文档审查 - 代码注释 (第7节)
✓ 合规性 - 可访问性 (第8节)
```

### B. API变更检查清单

```
✓ 自动化检查 (第1节)
✓ 性能审查 - 缓存策略 (第3节)
✓ 安全审查 (第4节 - 完整)
✓ 架构审查 - API设计 (第5节)
✓ 测试审查 - 集成测试 (第6节)
✓ 文档审查 - API文档 (第7节)
```

### C. 性能优化检查清单

```
✓ 自动化检查 (第1节)
✓ React代码 - 性能 (第2节)
✓ 性能审查 (第3节 - 完整)
✓ 测试审查 - 性能测试 (第6节)
```

### D. 架构重构检查清单

```
✓ 自动化检查 (第1节)
✓ 架构审查 (第5节 - 完整)
✓ 测试审查 (第6节 - 完整)
✓ 文档审查 (第7节 - 完整)
```

### E. 依赖更新检查清单

```
✓ 自动化检查 (第1节)
✓ 安全审查 - 依赖安全 (第4节)
✓ 合规性 - 许可证 (第8节)
✓ 测试审查 - 回归测试 (第6节)
```

---

## 审查流程

### 1. PR创建者自查 (提交前)

- [ ] 运行所有自动化检查命令
- [ ] 根据变更类型完成对应的专项检查清单
- [ ] 填写PR描述，说明变更内容和测试方法
- [ ] 确保CI检查通过

### 2. 审查者检查 (人工审查)

- [ ] 阅读PR描述，理解变更目的
- [ ] 根据变更类型选择对应检查清单
- [ ] 逐项检查，标注问题和建议
- [ ] 留下清晰的审查意见
- [ ] 批准或请求修改

### 3. 维护者最终检查 (合并前)

- [ ] 确认所有CI检查通过
- [ ] 确认审查意见已解决
- [ ] 评估变更影响范围
- [ ] 确认文档已更新
- [ ] 合并代码

---

## 快速审查命令

### 本地审查脚本

```bash
#!/bin/bash
# pre-review.sh - 提交前快速审查

echo "🔍 开始代码审查..."

# 1. 格式检查
echo "📝 检查代码格式..."
pnpm format:check || { echo "❌ 格式检查失败"; exit 1; }

# 2. 代码质量
echo "🔧 检查代码质量..."
pnpm lint || { echo "❌ ESLint检查失败"; exit 1; }

# 3. 类型检查
echo "📘 检查类型..."
pnpm build || { echo "❌ TypeScript编译失败"; exit 1; }

# 4. 测试
echo "🧪 运行测试..."
pnpm test || { echo "❌ 测试失败"; exit 1; }

# 5. 覆盖率
echo "📊 检查覆盖率..."
pnpm test:coverage || { echo "❌ 覆盖率不达标"; exit 1; }

# 6. 安全审计
echo "🔒 安全审计..."
pnpm audit --audit-level=high || { echo "⚠️ 发现安全漏洞"; }

echo "✅ 所有检查通过！"
```

### 使用方式

```bash
chmod +x pre-review.sh
./pre-review.sh
```

---

## 审查意见模板

### 批准模板

```markdown
✅ LGTM!

已审查以下方面:

- [ ] 代码质量和可读性
- [ ] 测试覆盖充分
- [ ] 文档完整
- [ ] 安全考虑周全

建议: [可选的改进建议]
```

### 请求修改模板

```markdown
🔴 需要修改

**阻断问题:**

1. [问题描述] - 文件位置:行号
2. ...

🟡 建议改进:

1. [建议描述]
2. ...

请修复阻断问题后重新提交审查。
```

---

## 附录: 审查工具清单

### 自动化工具

- ✅ Prettier - 代码格式化
- ✅ ESLint - 代码质量检查
- ✅ TypeScript - 类型检查
- ✅ Vitest - 测试框架
- ✅ Playwright - E2E测试
- ✅ Lighthouse CI - 性能审计

### 手动工具

- ✅ React DevTools - 组件调试
- ✅ Chrome DevTools - 性能分析
- ✅ Rollup Plugin Visualizer - Bundle分析

### CI集成

- ✅ GitHub Actions - 自动化CI/CD
- ✅ Husky - Git Hooks
- ✅ Lint-staged - 提交前检查
- ✅ Commitlint - 提交消息检查

---

## 持续改进

本检查清单将根据以下反馈持续优化：

- 📊 代码审查统计数据
- 💬 开发者反馈
- 🐛 生产环境问题分析
- 📚 最新最佳实践

**季度审查**: 每季度评估并更新检查清单

**反馈渠道**: 通过Issue或团队会议提出改进建议

---

> **提示**: 将此检查清单加入PR模板，确保每次审查都遵循标准流程。
